finaltable$ethnicity<- relevel(finaltable$ethnicity == "2")
finaltable$ethnicity<- relevel(finaltable$ethnicity = "WHITE")
finaltable$ethnicity<- relevel(finaltable$ethnicity == "WHITE")
finaltable$ethnicity<- relevel(finaltable$ethnicity, ref = "WHITE")
firstlook <- glm(finaltable$formulary_drug_cd ~ finaltable$ethnicity + finaltable$med.pain)
summary(firstlook)
firstlook <- lm(finaltable$formulary_drug_cd ~ finaltable$ethnicity + finaltable$med.pain, method = "logit")
firstlook <- lm(finaltable$formulary_drug_cd ~ finaltable$ethnicity + finaltable$med.pain, family = binomial(link = "logit")
summary(firstlook)
firstlook <- lm(finaltable$formulary_drug_cd ~ finaltable$ethnicity + finaltable$med.pain, family = binomial(link = "logit"))
summary(firstlook)
finaltable0205<- filter(finaltable, finaltable$admityear == "2002" |finaltable$admityear == "2003" |finaltable$admityear == "2004" |finaltable$admityear == "2005" )
years1 <- lm(finaltable0205$formulary_drug_cd ~ finaltable0205$ethnicity + finaltable0205$med.pain, family = binomial(link = "logit"))
summary(firstlook)
summary(years1)
finaltable0608<- filter(finaltable, finaltable$admityear == "2006" |finaltable$admityear == "2007" |finaltable$admityear == "2008")
years1 <- lm(finaltable0205$formulary_drug_cd ~ finaltable0205$ethnicity + finaltable0205$med.pain, family = binomial(link = "logit"))
summary(years1)
finaltable0608<- filter(finaltable, finaltable$admityear == "2006" |finaltable$admityear == "2007" |finaltable$admityear == "2008")
years2 <- lm(finaltable0608$formulary_drug_cd ~ finaltable0608$ethnicity + finaltable0605$med.pain, family = binomial(link = "logit"))
finaltable0608<- filter(finaltable, finaltable$admityear == "2006" |finaltable$admityear == "2007" |finaltable$admityear == "2008")
years2 <- lm(finaltable0608$formulary_drug_cd ~ finaltable0608$ethnicity + finaltable0608$med.pain, family = binomial(link = "logit"))
summary(years2)
finaltable0911<- filter(finaltable, finaltable$admityear == "2009" |finaltable$admityear == "2010" |finaltable$admityear == "2011")
years3 <- lm(finaltable0911$formulary_drug_cd ~ finaltable0911$ethnicity + finaltable0911$med.pain, family = binomial(link = "logit"))
summary(years3)
secondlook <- lm(finaltable$formulary_drug_cd ~ finaltable$ethnicity + finaltable$med.pain + finaltable$gender + finaltable$age + finaltable$insurance.y + finaltable$marital_status.y, family = binomial(link = "logit"))
summary(secondlook)
year1secondlook <- lm(finaltable0205$formulary_drug_cd ~ finaltable0205$ethnicity + finaltable0205$med.pain + finaltable0205$gender + finaltable0205$age + finaltable0205$insurance.y + finaltable0205$marital_status.y, family = binomial)
summary(year1secondlook)
year1secondlook <- lm(finaltable0205$formulary_drug_cd ~ finaltable0205$ethnicity + finaltable0205$med.pain + finaltable0205$gender + finaltable0205$age + finaltable0205$insurance.y + finaltable0205$marital_status.y)
summary(year1secondlook)
year1secondlook <- glm(finaltable0205$formulary_drug_cd ~ finaltable0205$ethnicity + finaltable0205$med.pain + finaltable0205$gender + finaltable0205$age + finaltable0205$insurance.y + finaltable0205$marital_status.y)
summary(year1secondlook)
secondlook <- glm(finaltable$formulary_drug_cd ~ finaltable$ethnicity + finaltable$med.pain + finaltable$gender + finaltable$age + finaltable$insurance.y + finaltable$marital_status.y + finaltable$oasis, family = binomial(link = "logit"))
summary(secondlook)
secondlook <- glm(finaltable$formulary_drug_cd ~ finaltable$ethnicity + finaltable$med.pain + finaltable$gender + finaltable$age + finaltable$insurance.y + finaltable$marital_status.y, family = binomial(link = "logit"))
year1secondlook <- glm(finaltable0205$formulary_drug_cd ~ finaltable0205$ethnicity + finaltable0205$med.pain + finaltable0205$gender + finaltable0205$age + finaltable0205$insurance.y + finaltable0205$marital_status.y, family = binomial(link = "logit"))
summary(year1secondlook)
year2secondlook <- glm(finaltable0608$formulary_drug_cd ~ finaltable0608$ethnicity + finaltable0608$med.pain + finaltable0608$gender + finaltable0608$age + finaltable0608$insurance.y + finaltable0608$marital_status.y, family = binomial(link = "logit"))
summary(year2secondlook)
year3secondlook <- glm(finaltable0911$formulary_drug_cd ~ finaltable0911$ethnicity + finaltable0911$med.pain + finaltable0911$gender + finaltable0911$age + finaltable0911$insurance.y + finaltable0911$marital_status.y, family = binomial(link = "logit"))
summary(year3secondlook)
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(tidyverse)
finaltable <- read_csv("~/SSmimic/finaltable.csv")
head((finaltable))
finaltable$insurance.y<- as.factor(finaltable$insurance.y)
finaltable$ethnicity<- as.factor(finaltable$ethnicity)
finaltable$marital_status.y<- as.factor(finaltable$marital_status.y)
finaltable$ethnicity<- relevel(finaltable$ethnicity, ref = "WHITE")
finaltable$marital_status.y<- relevel(finaltable$marital_status.y, ref = "MARRIED")
firstlook <- glm(finaltable$formulary_drug_cd ~ finaltable$ethnicity + finaltable$med.pain, family = binomial(link = "logit"))
summary(firstlook)
finaltable0205<- filter(finaltable, finaltable$admityear == "2002" |finaltable$admityear == "2003" |finaltable$admityear == "2004" |finaltable$admityear == "2005" )
years1 <- glm(finaltable0205$formulary_drug_cd ~ finaltable0205$ethnicity + finaltable0205$med.pain, family = binomial(link = "logit"))
summary(years1)
finaltable0608<- filter(finaltable, finaltable$admityear == "2006" |finaltable$admityear == "2007" |finaltable$admityear == "2008")
years2 <- glm(finaltable0608$formulary_drug_cd ~ finaltable0608$ethnicity + finaltable0608$med.pain, family = binomial(link = "logit"))
summary(years2)
finaltable0911<- filter(finaltable, finaltable$admityear == "2009" |finaltable$admityear == "2010" |finaltable$admityear == "2011")
years3 <- glm(finaltable0911$formulary_drug_cd ~ finaltable0911$ethnicity + finaltable0911$med.pain, family = binomial(link = "logit"))
summary(years3)
secondlook <- glm(finaltable$formulary_drug_cd ~ finaltable$ethnicity + finaltable$med.pain + finaltable$gender + finaltable$age + finaltable$insurance.y + finaltable$marital_status.y, family = binomial(link = "logit"))
summary(secondlook)
year1secondlook <- glm(finaltable0205$formulary_drug_cd ~ finaltable0205$ethnicity + finaltable0205$med.pain + finaltable0205$gender + finaltable0205$age + finaltable0205$insurance.y + finaltable0205$marital_status.y, family = binomial(link = "logit"))
summary(year1secondlook)
year2secondlook <- glm(finaltable0608$formulary_drug_cd ~ finaltable0608$ethnicity + finaltable0608$med.pain + finaltable0608$gender + finaltable0608$age + finaltable0608$insurance.y + finaltable0608$marital_status.y, family = binomial(link = "logit"))
summary(year2secondlook)
year3secondlook <- glm(finaltable0911$formulary_drug_cd ~ finaltable0911$ethnicity + finaltable0911$med.pain + finaltable0911$gender + finaltable0911$age + finaltable0911$insurance.y + finaltable0911$marital_status.y, family = binomial(link = "logit"))
summary(year3secondlook)
year3secondlook <- glm(finaltable0911$formulary_drug_cd ~ finaltable0911$ethnicity + finaltable0911$med.pain + finaltable0911$gender + finaltable0911$age + finaltable0911$insurance.y + finaltable0911$marital_status.y +finaltable0911$oasis, family = binomial(link = "logit"))
year3secondlook <- glm(finaltable0911$formulary_drug_cd ~ finaltable0911$ethnicity + finaltable0911$med.pain + finaltable0911$gender + finaltable0911$age + finaltable0911$insurance.y + finaltable0911$marital_status.y +finaltable0911$oasis, family = binomial(link = "logit"))
summary(year3secondlook)
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(tidyverse)
finaltable <- read_csv("~/SSmimic/finaltable.csv")
head((finaltable))
finaltable$insurance.y<- as.factor(finaltable$insurance.y)
finaltable$ethnicity<- as.factor(finaltable$ethnicity)
finaltable$marital_status.y<- as.factor(finaltable$marital_status.y)
finaltable$ethnicity<- relevel(finaltable$ethnicity, ref = "WHITE")
finaltable$marital_status.y<- relevel(finaltable$marital_status.y, ref = "MARRIED")
firstlook <- glm(finaltable$formulary_drug_cd ~ finaltable$ethnicity + finaltable$med.pain, family = binomial(link = "logit"))
summary(firstlook)
finaltable0205<- filter(finaltable, finaltable$admityear == "2002" |finaltable$admityear == "2003" |finaltable$admityear == "2004" |finaltable$admityear == "2005" )
years1 <- glm(finaltable0205$formulary_drug_cd ~ finaltable0205$ethnicity + finaltable0205$med.pain, family = binomial(link = "logit"))
summary(years1)
finaltable0608<- filter(finaltable, finaltable$admityear == "2006" |finaltable$admityear == "2007" |finaltable$admityear == "2008")
years2 <- glm(finaltable0608$formulary_drug_cd ~ finaltable0608$ethnicity + finaltable0608$med.pain, family = binomial(link = "logit"))
summary(years2)
finaltable0911<- filter(finaltable, finaltable$admityear == "2009" |finaltable$admityear == "2010" |finaltable$admityear == "2011")
years3 <- glm(finaltable0911$formulary_drug_cd ~ finaltable0911$ethnicity + finaltable0911$med.pain, family = binomial(link = "logit"))
summary(years3)
secondlook <- glm(finaltable$formulary_drug_cd ~ finaltable$ethnicity + finaltable$med.pain + finaltable$gender + finaltable$age + finaltable$insurance.y + finaltable$marital_status.y +finaltable$oasis, family = binomial(link = "logit"))
summary(secondlook)
year1secondlook <- glm(finaltable0205$formulary_drug_cd ~ finaltable0205$ethnicity + finaltable0205$med.pain + finaltable0205$gender + finaltable0205$age + finaltable0205$insurance.y + finaltable0205$marital_status.y+finaltable0205$oasis, family = binomial(link = "logit"))
summary(year1secondlook)
year2secondlook <- glm(finaltable0608$formulary_drug_cd ~ finaltable0608$ethnicity + finaltable0608$med.pain + finaltable0608$gender + finaltable0608$age + finaltable0608$insurance.y + finaltable0608$marital_status.y+finaltable0608$oasis, family = binomial(link = "logit"))
summary(year2secondlook)
year3secondlook <- glm(finaltable0911$formulary_drug_cd ~ finaltable0911$ethnicity + finaltable0911$med.pain + finaltable0911$gender + finaltable0911$age + finaltable0911$insurance.y + finaltable0911$marital_status.y +finaltable0911$oasis, family = binomial(link = "logit"))
summary(year3secondlook)
View(finaltable)
finaltable<- filter(finaltable, finaltable$e_score < 10)
finaltable<- filter(finaltable, finaltable$e_score < 10)
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(tidyverse)
finaltable <- read_csv("~/SSmimic/finaltable.csv")
head((finaltable))
finaltable<- filter(finaltable, finaltable$e_score < 10)
finaltable$insurance.y<- as.factor(finaltable$insurance.y)
finaltable$ethnicity<- as.factor(finaltable$ethnicity)
finaltable$marital_status.y<- as.factor(finaltable$marital_status.y)
finaltable$ethnicity<- relevel(finaltable$ethnicity, ref = "WHITE")
finaltable$marital_status.y<- relevel(finaltable$marital_status.y, ref = "MARRIED")
firstlook <- glm(finaltable$formulary_drug_cd ~ finaltable$ethnicity + finaltable$med.pain, family = binomial(link = "logit"))
summary(firstlook)
finaltable0205<- filter(finaltable, finaltable$admityear == "2002" |finaltable$admityear == "2003" |finaltable$admityear == "2004" |finaltable$admityear == "2005" )
years1 <- glm(finaltable0205$formulary_drug_cd ~ finaltable0205$ethnicity + finaltable0205$med.pain, family = binomial(link = "logit"))
summary(years1)
finaltable0608<- filter(finaltable, finaltable$admityear == "2006" |finaltable$admityear == "2007" |finaltable$admityear == "2008")
years2 <- glm(finaltable0608$formulary_drug_cd ~ finaltable0608$ethnicity + finaltable0608$med.pain, family = binomial(link = "logit"))
summary(years2)
finaltable0911<- filter(finaltable, finaltable$admityear == "2009" |finaltable$admityear == "2010" |finaltable$admityear == "2011")
years3 <- glm(finaltable0911$formulary_drug_cd ~ finaltable0911$ethnicity + finaltable0911$med.pain, family = binomial(link = "logit"))
summary(years3)
secondlook <- glm(finaltable$formulary_drug_cd ~ finaltable$ethnicity + finaltable$med.pain + finaltable$gender + finaltable$age + finaltable$insurance.y + finaltable$marital_status.y +finaltable$oasis, family = binomial(link = "logit"))
summary(secondlook)
year1secondlook <- glm(finaltable0205$formulary_drug_cd ~ finaltable0205$ethnicity + finaltable0205$med.pain + finaltable0205$gender + finaltable0205$age + finaltable0205$insurance.y + finaltable0205$marital_status.y+finaltable0205$oasis, family = binomial(link = "logit"))
summary(year1secondlook)
year2secondlook <- glm(finaltable0608$formulary_drug_cd ~ finaltable0608$ethnicity + finaltable0608$med.pain + finaltable0608$gender + finaltable0608$age + finaltable0608$insurance.y + finaltable0608$marital_status.y+finaltable0608$oasis, family = binomial(link = "logit"))
summary(year2secondlook)
year3secondlook <- glm(finaltable0911$formulary_drug_cd ~ finaltable0911$ethnicity + finaltable0911$med.pain + finaltable0911$gender + finaltable0911$age + finaltable0911$insurance.y + finaltable0911$marital_status.y +finaltable0911$oasis, family = binomial(link = "logit"))
summary(year3secondlook)
View(finaltable)
library(tidyverse)
library(readr)
IVopioid <- read_csv("~/SSmimic/Medication/IVtable_nodup.csv")
cohort <- read_csv("~/SSmimic/Cohort/cohort.csv")
#merger the tables to ease analysis
finaltable<- left_join(cohort,IVopioid, "hadm_id")
#Replacing NA to 0 and receiving an IV opioid to 1:
finaltable$formulary_drug_cd<- ifelse(is.na(finaltable$formulary_drug_cd),0,1)
#categorize race into 4 categories
finaltable$ethnicity <- ifelse(grepl("BLACK",finaltable$ethnicity),"BLACK", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("WHITE",finaltable$ethnicity),"WHITE", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("HISPANIC",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ASIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("UN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("MUL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("INDIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("SOUTH",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ISLAND",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("DECL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("EAST",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("PORTU",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity[is.na(finaltable$ethnicity)]<-"OTHER"
#categorize marital status into 4 categories
finaltable$marital_status.y <- ifelse(grepl("MARRIED",finaltable$marital_status.y),"MARRIED", finaltable$marital_status.y)
finaltable$marital_status.y <- ifelse(grepl("LIFE PARTNER",finaltable$marital_status.y),"MARRIED", finaltable$marital_status.y)
finaltable$marital_status.y <- ifelse(grepl("DIVORCED",finaltable$marital_status.y),"DIVORCED/WIDOWED", finaltable$marital_status.y)
finaltable$marital_status.y <- ifelse(grepl("SEPARATED",finaltable$marital_status.y),"DIVORCED/WIDOWED", finaltable$marital_status.y)
finaltable$marital_status.y <- ifelse(grepl("WIDOW",finaltable$marital_status.y),"DIVORCED/WIDOWED", finaltable$marital_status.y)
finaltable$marital_status.y <- ifelse(grepl("UN",finaltable$marital_status.y),"OTHER", finaltable$marital_status.y)
finaltable$marital_status.y[is.na(finaltable$marital_status.y)]<-"OTHER"
#categorize insurance into 3 catergories
finaltable$insurance.y <- ifelse(grepl("Medi",finaltable$insurance.y),"Government", finaltable$insurance.y)
#check that ethnicity, marital status and insurance were correctly categorised
unique(finaltable$ethnicity)
unique(finaltable$marital_status.y)
unique(finaltable$insurance.y)
#filter out years 2001 and 2012 as they are incomplete years
finaltable<- filter(finaltable, !finaltable$admityear == "2001" & !finaltable$admityear == "2012")
finaltable<- select(finaltable,"hadm_id", "subject_id.x", "med.pain", "insurance.y", "marital_status.y", "age", "gender", "ethnicity", "max_pain", "mean.pain", "oasis", "e_score", "admityear", "drug", "drug_name_generic", "formulary_drug_cd")
#exclude patients with an Elixhauser score that is 10 or more
finaltable<- filter(finaltable, finaltable$e_score < 10)
#write csv final table: cohort plus IV opioids woth no duplicated hadm_id's
write.csv(finaltable, file = "finaltable.csv")
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(tidyverse)
finaltable <- read_csv("~/SSmimic/finaltable.csv")
head((finaltable))
finaltable$insurance.y<- as.factor(finaltable$insurance.y)
finaltable$ethnicity<- as.factor(finaltable$ethnicity)
finaltable$marital_status.y<- as.factor(finaltable$marital_status.y)
finaltable$ethnicity<- relevel(finaltable$ethnicity, ref = "WHITE")
finaltable$marital_status.y<- relevel(finaltable$marital_status.y, ref = "MARRIED")
firstlook <- glm(finaltable$formulary_drug_cd ~ finaltable$ethnicity + finaltable$med.pain, family = binomial(link = "logit"))
summary(firstlook)
finaltable0205<- filter(finaltable, finaltable$admityear == "2002" |finaltable$admityear == "2003" |finaltable$admityear == "2004" |finaltable$admityear == "2005" )
years1 <- glm(finaltable0205$formulary_drug_cd ~ finaltable0205$ethnicity + finaltable0205$med.pain, family = binomial(link = "logit"))
summary(years1)
finaltable0608<- filter(finaltable, finaltable$admityear == "2006" |finaltable$admityear == "2007" |finaltable$admityear == "2008")
years2 <- glm(finaltable0608$formulary_drug_cd ~ finaltable0608$ethnicity + finaltable0608$med.pain, family = binomial(link = "logit"))
summary(years2)
finaltable0911<- filter(finaltable, finaltable$admityear == "2009" |finaltable$admityear == "2010" |finaltable$admityear == "2011")
years3 <- glm(finaltable0911$formulary_drug_cd ~ finaltable0911$ethnicity + finaltable0911$med.pain, family = binomial(link = "logit"))
summary(years3)
secondlook <- glm(finaltable$formulary_drug_cd ~ finaltable$ethnicity + finaltable$med.pain + finaltable$gender + finaltable$age + finaltable$insurance.y + finaltable$marital_status.y +finaltable$oasis, family = binomial(link = "logit"))
summary(secondlook)
year1secondlook <- glm(finaltable0205$formulary_drug_cd ~ finaltable0205$ethnicity + finaltable0205$med.pain + finaltable0205$gender + finaltable0205$age + finaltable0205$insurance.y + finaltable0205$marital_status.y+finaltable0205$oasis, family = binomial(link = "logit"))
summary(year1secondlook)
year2secondlook <- glm(finaltable0608$formulary_drug_cd ~ finaltable0608$ethnicity + finaltable0608$med.pain + finaltable0608$gender + finaltable0608$age + finaltable0608$insurance.y + finaltable0608$marital_status.y+finaltable0608$oasis, family = binomial(link = "logit"))
summary(year2secondlook)
year3secondlook <- glm(finaltable0911$formulary_drug_cd ~ finaltable0911$ethnicity + finaltable0911$med.pain + finaltable0911$gender + finaltable0911$age + finaltable0911$insurance.y + finaltable0911$marital_status.y +finaltable0911$oasis, family = binomial(link = "logit"))
summary(year3secondlook)
library(ggplot2)
library(dplyr)
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity)) +
geom_boxplot()
year2002_2005
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, formulary_drug_cd)) +
geom_boxplot()
year2002_2005
year2002_2005 <- ggplot(finaltable0205, aes(formulary_drug_cd, ethnicity)) +
geom_boxplot()
year2002_2005
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, formulary_drug_cd)) +
geom_line()
year2002_2005
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, formulary_drug_cd)) +
geom_point()
year2002_2005
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, formulary_drug_cd)) +
geom_pointrange()
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, formulary_drug_cd)) +
geom_bar(position = "fill")
year2002_2005
year2002_2005 <- ggplot(finaltable0205, aes(formulary_drug_cd,ethnicity)) +
geom_bar(position = "fill")
year2002_2005
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd)) +
geom_bar(position = "fill")
year2002_2005
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill")
year2002_2005
year2006_2008 <- ggplot(finaltable0608, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill")
year2006_2008
year2009_2011 <- ggplot(finaltable0911, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill")
year2009_2011
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill" +
geom_text(stat='count',aes(label=..count..),vjust=-0.7) +
labs(x = "Ethnicity", fill = "Received IV Opioids"))
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
geom_text(stat='count',aes(label=..count..),vjust=-0.7) +
labs(x = "Ethnicity", fill = "Received IV Opioids")
year2002_2005
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
geom_text(stat='count',aes(label=..count..)) +
labs(x = "Ethnicity", fill = "Received IV Opioids")
year2002_2005
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
geom_text(stat='count',aes()) +
labs(x = "Ethnicity", fill = "Received IV Opioids")
year2002_2005
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
geom_text(aes(count)) +
labs(x = "Ethnicity", fill = "Received IV Opioids")
year2002_2005
(x = "Ethnicity", fill = "Received IV Opioids")
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids")
year2002_2005
finaltable0608<- filter(finaltable, finaltable$admityear == "2006" |finaltable$admityear == "2007" |finaltable$admityear == "2008")
year2006_2008 <- ggplot(finaltable0608, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids")
year2006_2008
years2 <- glm(finaltable0608$formulary_drug_cd ~ finaltable0608$ethnicity + finaltable0608$med.pain, family = binomial(link = "logit"))
summary(years2)
year2009_2011 <- ggplot(finaltable0911, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids")
year2009_2011
year2006_2008 <- ggplot(finaltable0608, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids") +
geom_text(stat='count',aes(label=count))
year2006_2008
year2006_2008 <- ggplot(finaltable0608, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids") +
geom_text(stat='count',aes(label=.count.))
year2006_2008 <- ggplot(finaltable0608, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids") +
geom_text(stat='count',aes(label=.count.))
year2006_2008
year2006_2008 <- ggplot(finaltable0608, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids") +
geom_text(stat='count',aes(label=..count...))
year2006_2008
finaltable0608<- filter(finaltable, finaltable$admityear == "2006" |finaltable$admityear == "2007" |finaltable$admityear == "2008")
year2006_2008 <- ggplot(finaltable0608, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids") +
year2006_2008
finaltable0608<- filter(finaltable, finaltable$admityear == "2006" |finaltable$admityear == "2007" |finaltable$admityear == "2008")
year2006_2008 <- ggplot(finaltable0608, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids")
year2006_2008
years2 <- glm(finaltable0608$formulary_drug_cd ~ finaltable0608$ethnicity + finaltable0608$med.pain, family = binomial(link = "logit"))
summary(years2)
?geom_text
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids")+
geom_text(stat = count)
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids") +
geom_text(aes(stat = count))
year2002_2005
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids") +
geom_text(stat='count',aes(label="Count"))
year2002_2005
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids") +
geom_text(stat='count',aes(label= ..count...))
year2002_2005
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids") +
geom_text(stat='count',aes(label= ..count..))
year2002_2005
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids") +
geom_text(aes(label= ..count..))
year2002_2005
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids") +
geom_text(stat = "count",aes(label= ..count..), vjust=-1)
year2002_2005
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids") +
geom_text(stat = "count",aes(label= ..count..), vjust=1)
year2002_2005
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids") +
geom_text(stat = "count",aes(label= ..count..), vjust=10)
year2002_2005
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids") +
geom_text(stat = "count",aes(label= ..count..))
year2002_2005
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids")
year2002_2005
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids")
geom_text(stat = "identity",aes(label= ..identity..))
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids") +
geom_text(stat = "identity",aes(label= ..identity..))
year2002_2005
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids") +
geom_text(stat = "identity",aes(label= ..count..))
year2002_2005
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids") +
geom_text(aes(label= ..count..))
year2002_2005
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids") +
geom_text(aes(label= count))
year2002_2005
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids")+
geom_label()
year2002_2005
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids")+
geom_text(aes(label = formulary_drug_cd))
year2002_2005
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids")+
geom_text(aes(label = y))
year2002_2005
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids")+
geom_text(aes(label = finaltable0205$formulary_drug_cd))
year2002_2005
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids")
year2002_2005
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(dplyr)
library(tidyverse)
#Merging insurance and marital status with main table
library(readr)
main_table <- read_csv("/SSmimic/Cohort/main.table.csv")
#Merging insurance and marital status with main table
library(readr)
main_table <- read_csv("~/SSmimic/Cohort/main.table.csv")
msi <- read_csv("~/SSmimic/Medication/msi.csv")
main_table <- merge(main_table, msi, by ="hadm_id")
head(main_table)
#Merging insurance and marital status with main table
library(readr)
main_table <- read_csv("SSmimic/Cohort/main.table.csv")
#Merging years with main.table
#>>>>>>> d9d4abefe32dcd4d82d6c5a33251ba031172e8c9
years <- read_csv("/SSmimic/years.csv")
#Merging years with main.table
#>>>>>>> d9d4abefe32dcd4d82d6c5a33251ba031172e8c9
years <- read_csv("~/SSmimic/years.csv")
cohort<- merge(main_table,years,by="hadm_id")
write.csv(cohort, file = "cohort.csv")
Fentanyl <- read_csv("~/SSmimic/Medication/Fentanyl.csv")
Hydromorphone <- read_csv("~/SSmimic/Medication/Hydromorphone.csv")
Morphine <- read_csv("~/SSmimic/Medication/Morphine.csv")
Oxycodone <- read_csv("~/SSmimic/Medication/Oxycodone.csv")
Percocet <- read_csv("~/SSmimic/Medication/Percocet.csv")
Hydrocodone <- read_csv("~/SSmimic/Medication/Hydrocodone.csv")
#create tables with no duplicated hadm_id
Fent<- Fentanyl %>% distinct(hadm_id, .keep_all = TRUE)
Hydrom<- Hydromorphone %>% distinct(hadm_id, .keep_all = TRUE)
Morph<- Morphine %>% distinct(hadm_id, .keep_all = TRUE)
Oxycod<- Oxycodone %>% distinct(hadm_id, .keep_all = TRUE)
Perco <- Percocet %>% distinct(hadm_id, .keep_all = TRUE)
Hydrocod<- Hydrocodone %>% distinct(hadm_id, .keep_all = TRUE)
#create combined opioid medication table
opioid <- rbind(Fent,Hydrom, Morph, Oxycod, Perco, Hydrocod)
opioid_nohadmid<-  opioid %>% distinct(hadm_id, .keep_all = TRUE)
#create csv
write.csv(opioid, file = "opioid.csv")
#create  table with only IV drug presiscriptions and remove duplicated hadm_id
IVtable<- opioid[(opioid$route == "IV") |(opioid$route == "IV DRIP")|(opioid$route == "IVPCA") , ]
IVtable_nodup<-  IVtable %>% distinct(hadm_id, .keep_all = TRUE)
write.csv(IVtable_nodup,file = "IVtable_nodup.csv")
#create  table with NO IV drug presiscriptions and remove duplicated hadm_id
oralopioid<- opioid[!((opioid$route == "IV") |(opioid$route == "IV DRIP")|(opioid$route == "IVPCA")), ]
oralopioid_nodup<-  oralopioid %>% distinct(hadm_id, .keep_all = TRUE)
write.csv(oralopioid_nodup,file = "oralopioid_nodup.csv")
IVopioid <- read_csv("~/SSmimic/Medication/IVtable_nodup.csv")
cohort <- read_csv("~/SSmimic/Cohort/cohort.csv")
#merger the tables to ease analysis
finaltable<- left_join(cohort,IVopioid, "hadm_id")
#Replacing NA to 0 and receiving an IV opioid to 1:
finaltable$formulary_drug_cd<- ifelse(is.na(finaltable$formulary_drug_cd),0,1)
#categorize race into 4 categories
finaltable$ethnicity <- ifelse(grepl("BLACK",finaltable$ethnicity),"BLACK", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("WHITE",finaltable$ethnicity),"WHITE", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("HISPANIC",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ASIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("UN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("MUL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("INDIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("SOUTH",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ISLAND",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("DECL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("EAST",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("PORTU",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity[is.na(finaltable$ethnicity)]<-"OTHER"
#categorize marital status into 4 categories
finaltable$marital_status.y <- ifelse(grepl("MARRIED",finaltable$marital_status.y),"MARRIED", finaltable$marital_status.y)
finaltable$marital_status.y <- ifelse(grepl("LIFE PARTNER",finaltable$marital_status.y),"MARRIED", finaltable$marital_status.y)
finaltable$marital_status.y <- ifelse(grepl("DIVORCED",finaltable$marital_status.y),"DIVORCED/WIDOWED", finaltable$marital_status.y)
finaltable$marital_status.y <- ifelse(grepl("SEPARATED",finaltable$marital_status.y),"DIVORCED/WIDOWED", finaltable$marital_status.y)
finaltable$marital_status.y <- ifelse(grepl("WIDOW",finaltable$marital_status.y),"DIVORCED/WIDOWED", finaltable$marital_status.y)
finaltable$marital_status.y <- ifelse(grepl("UN",finaltable$marital_status.y),"OTHER", finaltable$marital_status.y)
finaltable$marital_status.y[is.na(finaltable$marital_status.y)]<-"OTHER"
#categorize insurance into 3 catergories
finaltable$insurance.y <- ifelse(grepl("Medi",finaltable$insurance.y),"Government", finaltable$insurance.y)
#check that ethnicity, marital status and insurance were correctly categorised
unique(finaltable$ethnicity)
unique(finaltable$marital_status.y)
unique(finaltable$insurance.y)
#exclude patients with an Elixhauser score that is 10 or more
finaltable<- filter(finaltable, finaltable$e_score < 10)
#filter out years 2001 and 2012 as they are incomplete years and select for relevant columns
finaltable<- filter(finaltable, !finaltable$admityear == "2001" & !finaltable$admityear == "2012")
#select relevant columns
finaltable<- select(finaltable,"subject_id.x", "hadm_id", "med.pain", "age", "gender", "ethnicity","max_pain", "mean.pain", "oasis", "e_score", "admityear", "drug", "formulary_drug_cd", "drug_name_generic", "marital_status.y","insurance.y")
#write csv final table: cohort plus IV opioids woth no duplicated hadm_id's
write.csv(finaltable, file = "finaltable.csv")
