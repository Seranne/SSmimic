main.table <- read.csv("/SSMimic/Final Code and Write Up/Main Table.csv")
main.table <- read.csv("~/SSMimic/Final Code and Write Up/Main Table.csv")
# Extract drugs from Prescriptions, and write .csv files for each:
fentanyl <- dbGetQuery(con, "select * from Fentanyl")
Fentanyl <- read_csv("~/SSmimic/Medication/Fentanyl.csv")
Hydromorphone <- read_csv("~/SSmimic/Medication/Hydromorphone.csv")
Morphine <- read_csv("~/SSmimic/Medication/Morphine.csv")
Oxycodone <- read_csv("~/SSmimic/Medication/Oxycodone.csv")
Percocet <- read_csv("~/SSmimic/Medication/Percocet.csv")
Hydrocodone <- read_csv("~/SSmimic/Medication/Hydrocodone.csv")
#create tables with no duplicated hadm_id
Fent<- Fentanyl %>% distinct(hadm_id, .keep_all = TRUE)
Hydrom<- Hydromorphone %>% distinct(hadm_id, .keep_all = TRUE)
Morph<- Morphine %>% distinct(hadm_id, .keep_all = TRUE)
Oxycod<- Oxycodone %>% distinct(hadm_id, .keep_all = TRUE)
Perco <- Percocet %>% distinct(hadm_id, .keep_all = TRUE)
Hydrocod<- Hydrocodone %>% distinct(hadm_id, .keep_all = TRUE)
#create combined opioid medication table
opioid <- rbind(Fent,Hydrom, Morph, Oxycod, Perco, Hydrocod)
opioid_nohadmid<-  opioid %>% distinct(hadm_id, .keep_all = TRUE)
#create csv
write.csv(opioid, file = "opioid.csv")
#create  table with only IV drug presiscriptions and remove duplicated hadm_id
IVtable<- opioid[(opioid$route == "IV") |(opioid$route == "IV DRIP")|(opioid$route == "IVPCA") , ]
IVtable_nodup<-  IVtable %>% distinct(hadm_id, .keep_all = TRUE)
write.csv(IVtable_nodup,file = "IVtable_nodup.csv")
#create  table with NO IV drug presiscriptions and remove duplicated hadm_id
oralopioid<- opioid[!((opioid$route == "IV") |(opioid$route == "IV DRIP")|(opioid$route == "IVPCA")), ]
oralopioid_nodup<-  oralopioid %>% distinct(hadm_id, .keep_all = TRUE)
write.csv(oralopioid_nodup,file = "oralopioid_nodup.csv")
finaltable <- left_join(main.table , IVtable_nodup, "hadm_id")
finaltable <-  select(finaltable, "subject_id.y", "hadm_id", "icustay_id", "age", "gender", "ethnicity", "marital_status", "insurance", "los_hospital", "los_icu", "admityear", "mean.pain", "med.pain", "max_pain", "oasis", "e_score", "drug")
colnames(finaltable)[1] <- "subject_id"
View(finaltable)
finaltable$drug[finaltable$drug == "D5W"] <- NA
finaltable$drug[finaltable$drug == "Hydrocortisone Na Succinate"] <- NA
finaltable$drug[finaltable$drug == "Soln."] <- NA
finaltable$drug[finaltable$drug == "Soln"] <- NA
finaltable$drug[finaltable$drug == "Hydrocortiso"] <- NA
finaltable$drug[finaltable$drug == "Syringe"] <- NA
finaltable$drug[finaltable$drug == "5% Dextrose"] <- NA
# Replacing NA to 0 and receiving an IV opioid to 1:
finaltable$drug<- ifelse(is.na(finaltable$drug),0,1)
View(finaltable)
write.csv(finaltable, file = "finaltable.csv")
# Sample size
length(unique(finaltable$hadm_id))
library(readr)
library(tidyverse)
library(ggplot2)
library(dplyr)
library(sjPlot)
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
head(finaltable)
unique(finaltable$drug)
sum(finaltable$formulary_drug_cd == "1" )
library(survival)
finaltable <- read_csv("/~SSmimic/Final Code and Write Up/finaltable.csv")
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
# categorize race into 4 categories
finaltable$ethnicity <- ifelse(grepl("BLACK",finaltable$ethnicity),"BLACK", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("WHITE",finaltable$ethnicity),"WHITE", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("HISPANIC",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ASIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("UN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("MUL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("INDIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("SOUTH",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ISLAND",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("DECL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("EAST",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("PORTU",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity[is.na(finaltable$ethnicity)]<-"OTHER"
#categorize marital status into 4 categories
finaltable$marital_status <- ifelse(grepl("MARRIED",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("LIFE PARTNER",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("DIVORCED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("SEPARATED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("WIDOW",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("UN",finaltable$marital_status),"OTHER", finaltable$marital_status)
finaltable$marital_status[is.na(finaltable$marital_status)]<-"OTHER"
#categorize insurance into 3 catergories
finaltable$insurance <- ifelse(grepl("Medi",finaltable$insurance),"Government", finaltable$insurance)
#check that ethnicity, marital status and insurance were correctly categorised
unique(finaltable$ethnicity)
unique(finaltable$marital_status)
unique(finaltable$insurance)
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
# categorize race into 4 categories
finaltable$ethnicity <- ifelse(grepl("BLACK",finaltable$ethnicity),"BLACK", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("WHITE",finaltable$ethnicity),"WHITE", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("HISPANIC",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ASIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("UN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("MUL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("INDIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("SOUTH",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ISLAND",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("DECL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("EAST",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("PORTU",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity[is.na(finaltable$ethnicity)]<-"OTHER"
#categorize marital status into 4 categories
finaltable$marital_status <- ifelse(grepl("MARRIED",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("LIFE PARTNER",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("DIVORCED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("SEPARATED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("WIDOW",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("UN",finaltable$marital_status),"OTHER", finaltable$marital_status)
finaltable$marital_status[is.na(finaltable$marital_status)]<-"OTHER"
#categorize insurance into 3 catergories
finaltable$insurance <- ifelse(grepl("Medi",finaltable$insurance),"Government", finaltable$insurance)
#check that ethnicity, marital status and insurance were correctly categorised
unique(finaltable$ethnicity)
unique(finaltable$marital_status)
unique(finaltable$insurance)
sum(is.na(finaltable$insurance))
sum(is.na(finaltable$e_score))
sum(is.na(finaltable$oasis))
sum(is.na(finaltable$oasis))
sum(is.na(finaltable$insurance))
sum(is.na(finaltable$oasis))
View(finaltable)
finaltable2<- na.omit(finaltable$admityear)
finaltable$admityear<- na.omit(finaltable$admityear)
finaltable<- na.omit(finaltable$admityear)
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
finaltable[!is.na(finaltable$admityear),]
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(mgcv)
library(dplyr)
require("RPostgreSQL")
library(stringr)
library(tidyverse)
library(readr)
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
finaltable[!is.na(finaltable$admityear),]
finaltable<- finaltable[!is.na(finaltable$admityear),]
# categorize race into 4 categories
finaltable$ethnicity <- ifelse(grepl("BLACK",finaltable$ethnicity),"BLACK", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("WHITE",finaltable$ethnicity),"WHITE", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("HISPANIC",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ASIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("UN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("MUL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("INDIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("SOUTH",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ISLAND",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("DECL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("EAST",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("PORTU",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity[is.na(finaltable$ethnicity)]<-"OTHER"
#categorize marital status into 4 categories
finaltable$marital_status <- ifelse(grepl("MARRIED",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("LIFE PARTNER",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("DIVORCED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("SEPARATED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("WIDOW",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("UN",finaltable$marital_status),"OTHER", finaltable$marital_status)
finaltable$marital_status[is.na(finaltable$marital_status)]<-"OTHER"
#categorize insurance into 3 catergories
finaltable$insurance <- ifelse(grepl("Medi",finaltable$insurance),"Government", finaltable$insurance)
#check that ethnicity, marital status and insurance were correctly categorised
unique(finaltable$ethnicity)
unique(finaltable$marital_status)
unique(finaltable$insurance)
library(readr)
library(tidyverse)
library(ggplot2)
library(dplyr)
library(sjPlot)
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
head(finaltable)
unique(finaltable$drug)
sum(finaltable$formulary_drug_cd == "1" )
library(survival)
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
finaltable<- finaltable[!is.na(finaltable$admityear),]
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
finaltable<- finaltable[!is.na(finaltable$admityear),]
# categorize race into 4 categories
finaltable$ethnicity <- ifelse(grepl("BLACK",finaltable$ethnicity),"BLACK", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("WHITE",finaltable$ethnicity),"WHITE", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("HISPANIC",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ASIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("UN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("MUL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("INDIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("SOUTH",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ISLAND",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("DECL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("EAST",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("PORTU",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity[is.na(finaltable$ethnicity)]<-"OTHER"
#categorize marital status into 4 categories
finaltable$marital_status <- ifelse(grepl("MARRIED",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("LIFE PARTNER",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("DIVORCED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("SEPARATED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("WIDOW",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("UN",finaltable$marital_status),"OTHER", finaltable$marital_status)
finaltable$marital_status[is.na(finaltable$marital_status)]<-"OTHER"
#categorize insurance into 3 catergories
finaltable$insurance <- ifelse(grepl("Medi",finaltable$insurance),"Government", finaltable$insurance)
#check that ethnicity, marital status and insurance were correctly categorised
unique(finaltable$ethnicity)
unique(finaltable$marital_status)
unique(finaltable$insurance)
write.csv(finaltable, file = "finaltable.csv")
library(readr)
library(tidyverse)
library(ggplot2)
library(dplyr)
library(sjPlot)
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
head(finaltable)
unique(finaltable$drug)
sum(finaltable$formulary_drug_cd == "1" )
library(survival)
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
finaltable$insurance<- as.factor(finaltable$insurance)
finaltable$ethnicity<- as.factor(finaltable$ethnicity)
finaltable$marital_status<- as.factor(finaltable$marital_status)
finaltable$ethnicity<- relevel(finaltable$ethnicity, ref = "WHITE")
finaltable$marital_status<- relevel(finaltable$marital_status, ref = "MARRIED")
finaltable0205<- filter(finaltable, finaltable$admityear == "2002" |finaltable$admityear == "2003" |finaltable$admityear == "2004" |finaltable$admityear == "2005" )
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = drug == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids")
year2002_2005
finaltable0608<- filter(finaltable, finaltable$admityear == "2006" |finaltable$admityear == "2007" |finaltable$admityear == "2008")
year2006_2008 <- ggplot(finaltable0608, aes(ethnicity, fill = drug == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids")
year2006_2008
finaltable0911<- filter(finaltable, finaltable$admityear == "2009" |finaltable$admityear == "2010" |finaltable$admityear == "2011")
year2009_2011 <- ggplot(finaltable0911, aes(ethnicity, fill = drug == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids")
year2009_2011
main.table <- read.csv("/SSMimic/Final Code and Write Up/Main Table.csv")
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(mgcv)
library(dplyr)
require("RPostgreSQL")
library(stringr)
library(tidyverse)
library(readr)
main.table <- read.csv("/SSMimic/Final Code and Write Up/Main Table.csv")
main.table <- read.csv("~/SSMimic/Final Code and Write Up/Main Table.csv")
main.table <- read.csv("~/SSMimic/Final Code and Write Up/Main Table.csv")
main.table <- read_csv("~/SSmimic/Final Code and Write Up/Main Table.csv")
Fentanyl <- read_csv("~/SSmimic/Medication/Fentanyl.csv")
Hydromorphone <- read_csv("~/SSmimic/Medication/Hydromorphone.csv")
Morphine <- read_csv("~/SSmimic/Medication/Morphine.csv")
Oxycodone <- read_csv("~/SSmimic/Medication/Oxycodone.csv")
Percocet <- read_csv("~/SSmimic/Medication/Percocet.csv")
Hydrocodone <- read_csv("~/SSmimic/Medication/Hydrocodone.csv")
Methadone <- read_csv("~/SSmimic/Medication/Methadone.csv")
#create tables with no duplicated hadm_id
Fent<- Fentanyl %>% distinct(hadm_id, .keep_all = TRUE)
Hydrom<- Hydromorphone %>% distinct(hadm_id, .keep_all = TRUE)
Morph<- Morphine %>% distinct(hadm_id, .keep_all = TRUE)
Oxycod<- Oxycodone %>% distinct(hadm_id, .keep_all = TRUE)
Perco <- Percocet %>% distinct(hadm_id, .keep_all = TRUE)
Hydrocod<- Hydrocodone %>% distinct(hadm_id, .keep_all = TRUE)
Meth <- Methadone %>% distinct(hadm_id, .keep_all = TRUE)
#create combined opioid medication table
opioid <- rbind(Fent,Hydrom, Morph, Oxycod, Perco, Hydrocod, Meth)
View(Meth)
View(Hydromorphone)
View(Hydromorphone)
View(main.table)
View(Meth)
main.table <- read_csv("~/SSmimic/Final Code and Write Up/main.table.csv")
#create tables with no duplicated hadm_id
Fent<- Fentanyl %>% distinct(hadm_id, .keep_all = TRUE) %>% select(Fentanyl, "X1", "subject_id", "hadm_id", "drug", "formulary_drug_cd", "drug_name_generic", "form_unit_disp", "route")
Fent<- Fentanyl %>% distinct(hadm_id, .keep_all = TRUE) %>% select(., "X1", "subject_id", "hadm_id", "drug", "formulary_drug_cd", "drug_name_generic", "form_unit_disp", "route")
#create tables with no duplicated hadm_id
Fent<- Fentanyl %>% distinct(hadm_id, .keep_all = TRUE) %>% select(., "X1", "subject_id", "hadm_id", "drug", "formulary_drug_cd", "drug_name_generic", "form_unit_disp", "route")
Hydrom<- Hydromorphone %>% distinct(hadm_id, .keep_all = TRUE)%>% select(., "X1", "subject_id", "hadm_id", "drug", "formulary_drug_cd", "drug_name_generic", "form_unit_disp", "route")
Morph<- Morphine %>% distinct(hadm_id, .keep_all = TRUE) %>% select(., "X1", "subject_id", "hadm_id", "drug", "formulary_drug_cd", "drug_name_generic", "form_unit_disp", "route")
Oxycod<- Oxycodone %>% distinct(hadm_id, .keep_all = TRUE) %>% select(., "X1", "subject_id", "hadm_id", "drug", "formulary_drug_cd", "drug_name_generic", "form_unit_disp", "route")
Perco <- Percocet %>% distinct(hadm_id, .keep_all = TRUE)%>% select(., "X1", "subject_id", "hadm_id", "drug", "formulary_drug_cd", "drug_name_generic", "form_unit_disp", "route")
Hydrocod<- Hydrocodone %>% distinct(hadm_id, .keep_all = TRUE) %>% select(., "X1", "subject_id", "hadm_id", "drug", "formulary_drug_cd", "drug_name_generic", "form_unit_disp", "route")
Meth <- Methadone %>% distinct(hadm_id, .keep_all = TRUE)
#create combined opioid medication table
opioid <- rbind(Fent,Hydrom, Morph, Oxycod, Perco, Hydrocod, Meth)
opioid_nohadmid<-  opioid %>% distinct(hadm_id, .keep_all = TRUE)
#create csv
write.csv(opioid, file = "opioid.csv")
#create  table with only IV drug presiscriptions and remove duplicated hadm_id
IVtable<- opioid[(opioid$route == "IV") |(opioid$route == "IV DRIP")|(opioid$route == "IVPCA") , ]
IVtable_nodup<-  IVtable %>% distinct(hadm_id, .keep_all = TRUE)
write.csv(IVtable_nodup,file = "IVtable_nodup.csv")
#create  table with NO IV drug presiscriptions and remove duplicated hadm_id
oralopioid<- opioid[!((opioid$route == "IV") |(opioid$route == "IV DRIP")|(opioid$route == "IVPCA")), ]
oralopioid_nodup<-  oralopioid %>% distinct(hadm_id, .keep_all = TRUE)
write.csv(oralopioid_nodup,file = "oralopioid_nodup.csv")
finaltable <- left_join(main.table , IVtable_nodup, "hadm_id")
finaltable <-  select(finaltable, "subject_id.y", "hadm_id", "icustay_id", "age", "gender", "ethnicity", "marital_status", "insurance", "los_hospital", "los_icu", "admityear", "mean.pain", "med.pain", "max_pain", "oasis", "e_score", "drug")
colnames(finaltable)[1] <- "subject_id"
View(finaltable)
finaltable$drug[finaltable$drug == "D5W"] <- NA
finaltable$drug[finaltable$drug == "Hydrocortisone Na Succinate"] <- NA
finaltable$drug[finaltable$drug == "Soln."] <- NA
finaltable$drug[finaltable$drug == "Soln"] <- NA
finaltable$drug[finaltable$drug == "Hydrocortiso"] <- NA
finaltable$drug[finaltable$drug == "Syringe"] <- NA
finaltable$drug[finaltable$drug == "5% Dextrose"] <- NA
# Replacing NA to 0 and receiving an IV opioid to 1:
finaltable$drug<- ifelse(is.na(finaltable$drug),0,1)
View(finaltable)
write.csv(finaltable, file = "finaltable.csv")
# Sample size
length(unique(finaltable$hadm_id))
finaltable <- read_csv("/SSmimic/Final Code and Write Up/finaltable.csv")
finaltable<- finaltable[!is.na(finaltable$admityear),]
# categorize race into 4 categories
finaltable$ethnicity <- ifelse(grepl("BLACK",finaltable$ethnicity),"BLACK", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("WHITE",finaltable$ethnicity),"WHITE", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("HISPANIC",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ASIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("UN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("MUL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("INDIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("SOUTH",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ISLAND",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("DECL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("EAST",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("PORTU",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity[is.na(finaltable$ethnicity)]<-"OTHER"
#categorize marital status into 4 categories
finaltable$marital_status <- ifelse(grepl("MARRIED",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("LIFE PARTNER",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("DIVORCED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("SEPARATED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("WIDOW",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("UN",finaltable$marital_status),"OTHER", finaltable$marital_status)
finaltable$marital_status[is.na(finaltable$marital_status)]<-"OTHER"
#categorize insurance into 3 catergories
finaltable$insurance <- ifelse(grepl("Medi",finaltable$insurance),"Government", finaltable$insurance)
#check that ethnicity, marital status and insurance were correctly categorised
unique(finaltable$ethnicity)
unique(finaltable$marital_status)
unique(finaltable$insurance)
write.csv(finaltable, file = "finaltable.csv")
library(readr)
library(tidyverse)
library(ggplot2)
library(dplyr)
library(sjPlot)
finaltable <- read_csv("/SSmimic/Final Code and Write Up/finaltable.csv")
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
sum(unique(finaltable$subject_id))
sum(is.na(finaltable$subject_id))
sum(finaltable$formulary_drug_cd == "1" )
sum(finaltable$drug == "1" )
sum(finaltable$drug == "0" )
final2<- finaltable %>% distinct(subject_id, .keep_all = TRUE)
final2$subject_id<- na.omit(final2$subject_id)
final2$subject_id<- na.omit(final2,final2$subject_id)
final2<- finaltable %>% distinct(subject_id, .keep_all = TRUE)
sum(final2$drug == "1" )
sum(is.na(final2$subject_id))
sum(final2$drug == "0" )
sum(finaltable$drug == "0" )
library(readr)
library(tidyverse)
library(ggplot2)
library(dplyr)
library(sjPlot)
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
head(finaltable)
sum(finaltable$drug == "0" )
library(survival)
unique(finaltable)
unique(finaltable$insurance)
finaltable$insurance<- as.factor(finaltable$insurance)
finaltable$ethnicity<- as.factor(finaltable$ethnicity)
finaltable$marital_status<- as.factor(finaltable$marital_status)
finaltable$ethnicity<- relevel(finaltable$ethnicity, ref = "WHITE")
finaltable$marital_status<- relevel(finaltable$marital_status, ref = "MARRIED")
primarymodel <- glm(finaltable$drug ~ finaltable$ethnicity, family = binomial(link = "logit"))
summary(primarymodel)
confint(primarymodel)
exp(coefficients(primarymodel))
exp(confint(primarymodel))
sjp.glm(primarymodel)
firstlook <- glm(finaltable$drug ~ finaltable$ethnicity + finaltable$mean.pain, family = binomial(link = "logit"))
summary(firstlook)
confint(firstlook)
exp(coefficients(firstlook))
exp(confint(firstlook))
sjp.glm(firstlook)
cond <- clogit(finaltable$drug ~ finaltable$age + strata(finaltable$mean.pain), method = "exact")
IVtable_nodup <- read_csv("~/SSmimic/Final Code and Write Up/IVtable_nodup.csv")
library(readr)
library(tidyverse)
library(ggplot2)
library(dplyr)
library(sjPlot)
IVtable_nodup <- read_csv("~/SSmimic/Final Code and Write Up/IVtable_nodup.csv")
unique(IVtable$drug)
main.table <- read_csv("~/SSmimic/Final Code and Write Up/main.table.csv")
Fentanyl <- read_csv("~/SSmimic/Medication/Fentanyl.csv")
Hydromorphone <- read_csv("~/SSmimic/Medication/Hydromorphone.csv")
Morphine <- read_csv("~/SSmimic/Medication/Morphine.csv")
Oxycodone <- read_csv("~/SSmimic/Medication/Oxycodone.csv")
Percocet <- read_csv("~/SSmimic/Medication/Percocet.csv")
Hydrocodone <- read_csv("~/SSmimic/Medication/Hydrocodone.csv")
Methadone <- read_csv("~/SSmimic/Medication/Methadone.csv")
#create tables with no duplicated hadm_id
Fent<- Fentanyl %>% distinct(hadm_id, .keep_all = TRUE) %>% select(., "X1", "subject_id", "hadm_id", "drug", "formulary_drug_cd", "drug_name_generic", "form_unit_disp", "route")
Hydrom<- Hydromorphone %>% distinct(hadm_id, .keep_all = TRUE)%>% select(., "X1", "subject_id", "hadm_id", "drug", "formulary_drug_cd", "drug_name_generic", "form_unit_disp", "route")
Morph<- Morphine %>% distinct(hadm_id, .keep_all = TRUE) %>% select(., "X1", "subject_id", "hadm_id", "drug", "formulary_drug_cd", "drug_name_generic", "form_unit_disp", "route")
Oxycod<- Oxycodone %>% distinct(hadm_id, .keep_all = TRUE) %>% select(., "X1", "subject_id", "hadm_id", "drug", "formulary_drug_cd", "drug_name_generic", "form_unit_disp", "route")
Perco <- Percocet %>% distinct(hadm_id, .keep_all = TRUE)%>% select(., "X1", "subject_id", "hadm_id", "drug", "formulary_drug_cd", "drug_name_generic", "form_unit_disp", "route")
Hydrocod<- Hydrocodone %>% distinct(hadm_id, .keep_all = TRUE) %>% select(., "X1", "subject_id", "hadm_id", "drug", "formulary_drug_cd", "drug_name_generic", "form_unit_disp", "route")
Meth <- Methadone %>% distinct(hadm_id, .keep_all = TRUE)
#create combined opioid medication table
opioid <- rbind(Fent,Hydrom, Morph, Oxycod, Perco, Hydrocod, Meth)
opioid_nohadmid<-  opioid %>% distinct(hadm_id, .keep_all = TRUE)
#create csv
write.csv(opioid, file = "opioid.csv")
#create  table with only IV drug presiscriptions and remove duplicated hadm_id
IVtable<- opioid[(opioid$route == "IV") |(opioid$route == "IV DRIP")|(opioid$route == "IVPCA") , ]
IVtable_nodup<-  IVtable %>% distinct(hadm_id, .keep_all = TRUE)
write.csv(IVtable_nodup,file = "IVtable_nodup.csv")
#create  table with NO IV drug presiscriptions and remove duplicated hadm_id
oralopioid<- opioid[!((opioid$route == "IV") |(opioid$route == "IV DRIP")|(opioid$route == "IVPCA")), ]
oralopioid_nodup<-  oralopioid %>% distinct(hadm_id, .keep_all = TRUE)
write.csv(oralopioid_nodup,file = "oralopioid_nodup.csv")
finaltable <- left_join(main.table , IVtable_nodup, "hadm_id")
finaltable <-  select(finaltable, "subject_id.y", "hadm_id", "icustay_id", "age", "gender", "ethnicity", "marital_status", "insurance", "los_hospital", "los_icu", "admityear", "mean.pain", "med.pain", "max_pain", "oasis", "e_score", "drug")
colnames(finaltable)[1] <- "subject_id"
#View(finaltable)
unique(finaltable$drug)
finaltable$drug[finaltable$drug == "D5W"] <- NA
finaltable$drug[finaltable$drug == "Hydrocortisone Na Succinate"] <- NA
finaltable$drug[finaltable$drug == "Soln."] <- NA
finaltable$drug[finaltable$drug == "Soln"] <- NA
finaltable$drug[finaltable$drug == "Hydrocortiso"] <- NA
finaltable$drug[finaltable$drug == "Syringe"] <- NA
finaltable$drug[finaltable$drug == "5% Dextrose"] <- NA
unique(finaltable$drug)
# Replacing NA to 0 and receiving an IV opioid to 1:
finaltable$drug<- ifelse(is.na(finaltable$drug),0,1)
View(finaltable)
write.csv(finaltable, file = "finaltable.csv")
# Sample size
length(unique(finaltable$hadm_id))
finaltable<- finaltable[!is.na(finaltable$admityear),]
write.csv(finaltable, file = "finaltable.csv")
# Sample size
length(unique(finaltable$hadm_id))
# categorize race into 4 categories
finaltable$ethnicity <- ifelse(grepl("BLACK",finaltable$ethnicity),"BLACK", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("WHITE",finaltable$ethnicity),"WHITE", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("HISPANIC",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ASIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("UN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("MUL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("INDIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("SOUTH",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ISLAND",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("DECL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("EAST",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("PORTU",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity[is.na(finaltable$ethnicity)]<-"OTHER"
#categorize marital status into 4 categories
finaltable$marital_status <- ifelse(grepl("MARRIED",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("LIFE PARTNER",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("DIVORCED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("SEPARATED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("WIDOW",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("UN",finaltable$marital_status),"OTHER", finaltable$marital_status)
finaltable$marital_status[is.na(finaltable$marital_status)]<-"OTHER"
#categorize insurance into 3 catergories
finaltable$insurance <- ifelse(grepl("Medi",finaltable$insurance),"Government", finaltable$insurance)
#check that ethnicity, marital status and insurance were correctly categorised
unique(finaltable$ethnicity)
unique(finaltable$marital_status)
unique(finaltable$insurance)
write.csv(finaltable, file = "finaltable.csv")
library(readr)
library(tidyverse)
library(ggplot2)
library(dplyr)
library(sjPlot)
finaltable <- read_csv("/SSmimic/Final Code and Write Up/finaltable.csv")
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
sum(finaltable$ethnicity =="WHITE")
sum(finaltable$ethnicity =="BLACK")
sum(finaltable$ethnicity =="HISPANIC")
sum(finaltable$ethnicity =="OTHER")
finaltable0205<- filter(finaltable, finaltable$admityear == "2002" |finaltable$admityear == "2003" |finaltable$admityear == "2004" |finaltable$admityear == "2005" )
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = drug == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids")
year2002_2005
length(finaltable0205)
finaltable0608<- filter(finaltable, finaltable$admityear == "2006" |finaltable$admityear == "2007" |finaltable$admityear == "2008")
finaltable0911<- filter(finaltable, finaltable$admityear == "2009" |finaltable$admityear == "2010" |finaltable$admityear == "2011")
sum(finaltable$insurance =="Government")
sum(finaltable$insurance =="Private")
sum(finaltable$insurance =="Self Pay")
View(finaltable)
