<<<<<<< HEAD
=======
<<<<<<< HEAD
unique(finaltable$ethnicity)
unique(finaltable$marital_status)
unique(finaltable$insurance)
finaltable$insurance<- as.factor(finaltable$insurance)
finaltable$ethnicity<- as.factor(finaltable$ethnicity)
finaltable$marital_status<- as.factor(finaltable$marital_status)
finaltable$ethnicity<- relevel(finaltable$ethnicity, ref = "WHITE")
finaltable$marital_status<- relevel(finaltable$marital_status, ref = "MARRIED")
write.csv(finaltable, file = "finaltable.csv")
# Sample size
length(unique(finaltable$hadm_id))
library(readr)
finaltable <- read_csv("F:/SSmimic/finaltable.csv")
View(finaltable)
finaltable <- read_csv("/SSmimic/Final Code and Write Up/finaltable.csv")
library(survival)
=======
race_bl<- filter(finaltable,finaltable$ethnicity == "BLACK")
a<- glm(race_bl$formulary_drug_cd ~ race_bl$oasis)
summary(a)
race_wh<- filter(finaltable,finaltable$ethnicity == "WHITE")
b<- glm(race_wh$formulary_drug_cd ~ race_wh$oasis)
summary(b)
knitr::opts_chunk$set(echo = TRUE)
>>>>>>> 20aff4128f47a57318c2f2338b78c16aff6a6386
library(readr)
library(tidyverse)
library(ggplot2)
library(dplyr)
library(sjPlot)
<<<<<<< HEAD
library(survival)
cond <- clogit(finaltable$drug ~ finaltable$ethnicity + strata(finaltable$mean.pain), method = "exact")
cond <- clogit(finaltable$drug ~ finaltable$ethnicity + strata(finaltable$mean.pain), method = "exact")
cond <- clogit(finaltable$drug ~ finaltable$age + strata(finaltable$mean.pain), method = "exact")
library(readr)
finaltable <- read_csv("F:/SSmimic/Final Code and Write Up/finaltable.csv")
View(finaltable)
finaltable <- left_join(main.table , IVtable_nodup, "hadm_id")
finaltable <-  select(finaltable, "subject_id.y", "hadm_id", "icustay_id", "age", "gender", "ethnicity", "marital_status", "insurance", "los_hospital", "los_icu", "admityear", "mean.pain", "med.pain", "max_pain", "oasis", "e_score", "drug")
colnames(finaltable)[1] <- "subject_id"
finaltable$drug[finaltable$drug == "D5W"] <- NA
finaltable$drug[finaltable$drug == "Hydrocortisone Na Succinate"] <- NA
finaltable$drug[finaltable$drug == "Soln."] <- NA
finaltable$drug[finaltable$drug == "Soln"] <- NA
finaltable$drug[finaltable$drug == "Hydrocortiso"] <- NA
finaltable$drug[finaltable$drug == "Syringe"] <- NA
finaltable$drug[finaltable$drug == "5% Dextrose"] <- NA
# Replacing NA to 0 and receiving an IV opioid to 1:
finaltable$drug<- ifelse(is.na(finaltable$drug),0,1)
View(finaltable)
# categorize race into 4 categories
finaltable$ethnicity <- ifelse(grepl("BLACK",finaltable$ethnicity),"BLACK", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("WHITE",finaltable$ethnicity),"WHITE", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("HISPANIC",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ASIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("UN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("MUL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("INDIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("SOUTH",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ISLAND",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("DECL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("EAST",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("PORTU",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity[is.na(finaltable$ethnicity)]<-"OTHER"
#categorize marital status into 4 categories
finaltable$marital_status <- ifelse(grepl("MARRIED",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("LIFE PARTNER",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("DIVORCED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("SEPARATED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("WIDOW",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("UN",finaltable$marital_status),"OTHER", finaltable$marital_status)
finaltable$marital_status[is.na(finaltable$marital_status)]<-"OTHER"
#categorize insurance into 3 catergories
finaltable$insurance <- ifelse(grepl("Medi",finaltable$insurance),"Government", finaltable$insurance)
#check that ethnicity, marital status and insurance were correctly categorised
unique(finaltable$ethnicity)
unique(finaltable$marital_status)
unique(finaltable$insurance)
finaltable$insurance<- as.factor(finaltable$insurance)
finaltable$ethnicity<- as.factor(finaltable$ethnicity)
finaltable$marital_status<- as.factor(finaltable$marital_status)
finaltable$ethnicity<- relevel(finaltable$ethnicity, ref = "WHITE")
finaltable <- left_join(main.table , IVtable_nodup, "hadm_id")
finaltable <-  select(finaltable, "subject_id.y", "hadm_id", "icustay_id", "age", "gender", "ethnicity", "marital_status", "insurance", "los_hospital", "los_icu", "admityear", "mean.pain", "med.pain", "max_pain", "oasis", "e_score", "drug")
colnames(finaltable)[1] <- "subject_id"
View(finaltable)
finaltable$drug[finaltable$drug == "D5W"] <- NA
finaltable$drug[finaltable$drug == "Hydrocortisone Na Succinate"] <- NA
finaltable$drug[finaltable$drug == "Soln."] <- NA
finaltable$drug[finaltable$drug == "Soln"] <- NA
finaltable$drug[finaltable$drug == "Hydrocortiso"] <- NA
finaltable$drug[finaltable$drug == "Syringe"] <- NA
finaltable$drug[finaltable$drug == "5% Dextrose"] <- NA
# Replacing NA to 0 and receiving an IV opioid to 1:
finaltable$drug<- ifelse(is.na(finaltable$drug),0,1)
View(finaltable)
write.csv(finaltable, file = "finaltable.csv")
# Sample size
length(unique(finaltable$hadm_id))
finaltable <- read_csv("/SSmimic/Final Code and Write Up/finaltable.csv")
# categorize race into 4 categories
=======
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
head((finaltable))
#Replacing NA to 0 and receiving an IV opioid to 1:
finaltable$formulary_drug_cd<- ifelse(is.na(finaltable$formulary_drug_cd),0,1)
#categorize race into 4 categories
>>>>>>> 20aff4128f47a57318c2f2338b78c16aff6a6386
finaltable$ethnicity <- ifelse(grepl("BLACK",finaltable$ethnicity),"BLACK", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("WHITE",finaltable$ethnicity),"WHITE", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("HISPANIC",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ASIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("UN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("MUL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("INDIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("SOUTH",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ISLAND",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("DECL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("EAST",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("PORTU",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity[is.na(finaltable$ethnicity)]<-"OTHER"
#categorize marital status into 4 categories
finaltable$marital_status <- ifelse(grepl("MARRIED",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("LIFE PARTNER",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("DIVORCED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("SEPARATED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("WIDOW",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("UN",finaltable$marital_status),"OTHER", finaltable$marital_status)
finaltable$marital_status[is.na(finaltable$marital_status)]<-"OTHER"
#categorize insurance into 3 catergories
finaltable$insurance <- ifelse(grepl("Medi",finaltable$insurance),"Government", finaltable$insurance)
#check that ethnicity, marital status and insurance were correctly categorised
unique(finaltable$ethnicity)
unique(finaltable$marital_status)
unique(finaltable$insurance)
finaltable$insurance<- as.factor(finaltable$insurance)
finaltable$ethnicity<- as.factor(finaltable$ethnicity)
finaltable$marital_status<- as.factor(finaltable$marital_status)
finaltable$ethnicity<- relevel(finaltable$ethnicity, ref = "WHITE")
finaltable$marital_status<- relevel(finaltable$marital_status, ref = "MARRIED")
<<<<<<< HEAD
finaltable <- read_csv("/SSmimic/Final Code and Write Up/finaltable.csv")
library(readr)
finaltable <- read_csv("F:/SSmimic/finaltable.csv")
View(finaltable)
library(readr)
finaltable <- read_csv("F:/SSmimic/Final Code and Write Up/finaltable.csv")
View(finaltable)
length(unique(finaltable$hadm_id))
length(unique(finaltable$subject_id))
length(unique(finaltable$subject_id[finaltable$drug == 1]))
length(unique(finaltable$hadm_id[finaltable$drug == 1]))
length(unique(finaltable$hadm_id[finaltable$drug == 0]))
length(unique(finaltable$subject_id[finaltable$drug == 0]))
read.csv("F://SSmimic/Final Code and Write Up/finaltable.csv")
library(tableone)
library(tidyverse)
library(dplyr)
read.csv("F://SSmimic/Final Code and Write Up/finaltable.csv")
finaltable <- read_csv("/SSmimic/Final Code and Write Up/finaltable.csv")
# categorize race into 4 categories
=======
firstlook <- glm(finaltable$formulary_drug_cd ~ finaltable$ethnicity + finaltable$mean.pain, family = binomial(link = "logit"))
summary(firstlook)
confint(firstlook)
exp(coefficients(firstlook))
exp(confint(firstlook))
sjplot(firstlook)
sjp(firstlook)
sjplot(years2)
sjp.glm(firstlook)
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(tidyverse)
library(ggplot2)
library(dplyr)
library(sjPlot)
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
head((finaltable))
#Replacing NA to 0 and receiving an IV opioid to 1:
finaltable$formulary_drug_cd<- ifelse(is.na(finaltable$formulary_drug_cd),0,1)
#categorize race into 4 categories
>>>>>>> 20aff4128f47a57318c2f2338b78c16aff6a6386
finaltable$ethnicity <- ifelse(grepl("BLACK",finaltable$ethnicity),"BLACK", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("WHITE",finaltable$ethnicity),"WHITE", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("HISPANIC",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ASIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("UN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("MUL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("INDIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("SOUTH",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ISLAND",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("DECL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("EAST",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("PORTU",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity[is.na(finaltable$ethnicity)]<-"OTHER"
#categorize marital status into 4 categories
finaltable$marital_status <- ifelse(grepl("MARRIED",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("LIFE PARTNER",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("DIVORCED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("SEPARATED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("WIDOW",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("UN",finaltable$marital_status),"OTHER", finaltable$marital_status)
finaltable$marital_status[is.na(finaltable$marital_status)]<-"OTHER"
#categorize insurance into 3 catergories
finaltable$insurance <- ifelse(grepl("Medi",finaltable$insurance),"Government", finaltable$insurance)
#check that ethnicity, marital status and insurance were correctly categorised
unique(finaltable$ethnicity)
unique(finaltable$marital_status)
unique(finaltable$insurance)
finaltable$insurance<- as.factor(finaltable$insurance)
finaltable$ethnicity<- as.factor(finaltable$ethnicity)
finaltable$marital_status<- as.factor(finaltable$marital_status)
finaltable$ethnicity<- relevel(finaltable$ethnicity, ref = "WHITE")
finaltable$marital_status<- relevel(finaltable$marital_status, ref = "MARRIED")
<<<<<<< HEAD
write.csv(finaltable, file = "finaltable.csv")
write.csv(finaltable, file = "finaltable.csv")
library(tableone)
=======
firstlook <- glm(finaltable$formulary_drug_cd ~ finaltable$ethnicity + finaltable$mean.pain, family = binomial(link = "logit"))
summary(firstlook)
confint(firstlook)
exp(coefficients(firstlook))
exp(confint(firstlook))
sjp.glm(firstlook)
finaltable0205<- filter(finaltable, finaltable$admityear == "2002" |finaltable$admityear == "2003" |finaltable$admityear == "2004" |finaltable$admityear == "2005" )
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids")
year2002_2005
years1 <- glm(finaltable0205$formulary_drug_cd ~ finaltable0205$ethnicity + finaltable0205$mean.pain, family = binomial(link = "logit"))
summary(years1)
confint(years1)
exp(coefficients(years1))
exp(confint(years1))
sjp.glm(years1)
finaltable0608<- filter(finaltable, finaltable$admityear == "2006" |finaltable$admityear == "2007" |finaltable$admityear == "2008")
year2006_2008 <- ggplot(finaltable0608, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids")
year2006_2008
years2 <- glm(finaltable0608$formulary_drug_cd ~ finaltable0608$ethnicity + finaltable0608$mean.pain, family = binomial(link = "logit"))
summary(years2)
confint(years2)
exp(coefficients(years2))
exp(confint(years2))
sjp.glm(years2)
finaltable0911<- filter(finaltable, finaltable$admityear == "2009" |finaltable$admityear == "2010" |finaltable$admityear == "2011")
year2009_2011 <- ggplot(finaltable0911, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids")
year2009_2011
years3 <- glm(finaltable0911$formulary_drug_cd ~ finaltable0911$ethnicity + finaltable0911$mean.pain, family = binomial(link = "logit"))
summary(years3)
confint(years3)
exp(coefficients(years3))
exp(confint(years3))
sjp.glm(years3)
secondlook <- glm(finaltable$formulary_drug_cd ~ finaltable$ethnicity + finaltable$mean.pain + finaltable$gender + finaltable$age + finaltable$insurance + finaltable$marital_status +finaltable$oasis, family = binomial(link = "logit"))
summary(secondlook)
confint(secondlook)
exp(coefficients(secondlook))
exp(confint(secondlook))
sjp.glm(secondlook)
year1secondlook <- glm(finaltable0205$formulary_drug_cd ~ finaltable0205$ethnicity + finaltable0205$mean.pain + finaltable0205$gender + finaltable0205$age + finaltable0205$insurance + finaltable0205$marital_status+finaltable0205$oasis, family = binomial(link = "logit"))
summary(year1secondlook)
confint(year1secondlook)
exp(coefficients(year1secondlook))
exp(confint(year1secondlook))
sjp.glm(year1secondlook)
year2secondlook <- glm(finaltable0608$formulary_drug_cd ~ finaltable0608$ethnicity + finaltable0608$mean.pain + finaltable0608$gender + finaltable0608$age + finaltable0608$insurance + finaltable0608$marital_status+finaltable0608$oasis, family = binomial(link = "logit"))
summary(year2secondlook)
summary(year2secondlook)
confint(year2secondlook)
exp(coefficients(year2secondlook))
exp(confint(year2secondlook))
sjp.glm(year2secondlook)
year3secondlook <- glm(finaltable0911$formulary_drug_cd ~ finaltable0911$ethnicity + finaltable0911$mean.pain + finaltable0911$gender + finaltable0911$age + finaltable0911$insurance + finaltable0911$marital_status +finaltable0911$oasis, family = binomial(link = "logit"))
summary(year3secondlook)
summary(year3secondlook)
confint(year3secondlook)
exp(coefficients(year3secondlook))
exp(confint(year3secondlook))
sjp.glm(year3secondlook)
#checking the link between oasis and opioids in each race category:
race_bl<- filter(finaltable,finaltable$ethnicity == "BLACK")
a<- glm(race_bl$formulary_drug_cd ~ race_bl$oasis)
summary(a)
race_wh<- filter(finaltable,finaltable$ethnicity == "WHITE")
b<- glm(race_wh$formulary_drug_cd ~ race_wh$oasis)
summary(b)
knitr::opts_chunk$set(echo = TRUE)
library(readr)
>>>>>>> 20aff4128f47a57318c2f2338b78c16aff6a6386
library(tidyverse)
library(dplyr)
<<<<<<< HEAD
read.csv("F://SSmimic/Final Code and Write Up/finaltable.csv")
=======
library(sjPlot)
finaltable <- read_csv("/SSmimic/Final Code and Write Up/finaltable.csv")
knitr::opts_chunk$set(echo = TRUE)
>>>>>>> 20aff4128f47a57318c2f2338b78c16aff6a6386
library(readr)
finaltable <- read_csv("F:/SSmimic/Final Code and Write Up/finaltable.csv")
View(finaltable)
library(tableone)
library(tidyverse)
library(dplyr)
<<<<<<< HEAD
read.csv("F://SSmimic/Final Code and Write Up/finaltable.csv")
finaltable <- read_csv("/SSmimic/Final Code and Write Up/finaltable.csv")
# categorize race into 4 categories
=======
library(sjPlot)
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
head(finaltable)
#Replacing NA to 0 and receiving an IV opioid to 1:
finaltable$formulary_drug_cd<- ifelse(is.na(finaltable$formulary_drug_cd),0,1)
#categorize race into 4 categories
>>>>>>> 20aff4128f47a57318c2f2338b78c16aff6a6386
finaltable$ethnicity <- ifelse(grepl("BLACK",finaltable$ethnicity),"BLACK", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("WHITE",finaltable$ethnicity),"WHITE", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("HISPANIC",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ASIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("UN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("MUL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("INDIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("SOUTH",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ISLAND",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("DECL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("EAST",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("PORTU",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity[is.na(finaltable$ethnicity)]<-"OTHER"
#categorize marital status into 4 categories
finaltable$marital_status <- ifelse(grepl("MARRIED",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("LIFE PARTNER",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("DIVORCED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("SEPARATED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("WIDOW",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("UN",finaltable$marital_status),"OTHER", finaltable$marital_status)
finaltable$marital_status[is.na(finaltable$marital_status)]<-"OTHER"
#categorize insurance into 3 catergories
finaltable$insurance <- ifelse(grepl("Medi",finaltable$insurance),"Government", finaltable$insurance)
#check that ethnicity, marital status and insurance were correctly categorised
unique(finaltable$ethnicity)
unique(finaltable$marital_status)
unique(finaltable$insurance)
finaltable$insurance<- as.factor(finaltable$insurance)
finaltable$ethnicity<- as.factor(finaltable$ethnicity)
finaltable$marital_status<- as.factor(finaltable$marital_status)
finaltable$ethnicity<- relevel(finaltable$ethnicity, ref = "WHITE")
finaltable$marital_status<- relevel(finaltable$marital_status, ref = "MARRIED")
<<<<<<< HEAD
write.csv(finaltable, file = "finaltable.csv")
library(tableone)
library(tidyverse)
library(dplyr)
read.csv("F://SSmimic/Final Code and Write Up/finaltable.csv")
library(readr)
finaltable <- read_csv("F:/SSmimic/finaltable.csv")
View(finaltable)
library(tableone)
library(tidyverse)
library(dplyr)
read.csv("F://SSmimic/Final Code and Write Up/finaltable.csv")
#adjusted global test for all the years
secondlook <- glm(finaltable$drug ~ finaltable$ethnicity + finaltable$mean.pain + finaltable$gender + finaltable$age + finaltable$insurance + finaltable$marital_status +finaltable$oasis + finaltable$e_score, family = binomial(link = "logit"))
summary(secondlook)
confint(secondlook)
exp(coefficients(secondlook))
exp(confint(secondlook))
sjp.glm(secondlook)
#adjusted global test for all the years
secondlook <- glm(finaltable$drug ~ finaltable$ethnicity + finaltable$mean.pain + finaltable$gender + finaltable$age +finaltable$oasis, family = binomial(link = "logit"))
=======
firstlook <- glm(finaltable$formulary_drug_cd ~ finaltable$ethnicity + finaltable$mean.pain, family = binomial(link = "logit"))
summary(firstlook)
confint(firstlook)
exp(coefficients(firstlook))
exp(confint(firstlook))
sjp.glm(firstlook)
black <- filter(finaltable, finaltable$ethnicity == "BLACK")
white <- filter(finaltable, finaltable$ethnicity == "WHITE")
hispanic <- filter(finaltable, finaltable$ethnicity == "HISPANIC")
other <- filter(finaltable, finaltable$ethnicity == "OTHER")
class(black$mean.pain)
#All ethnicities
df <- with(finaltable, data.frame(pain = finaltable$mean.pain, ethnicity = finaltable$ethnicity))
pred <- predict(firstlook, df, type = "response", se.fit = TRUE)
predf <- pred$fit
lower <- pred$fit - (1.96*pred$se.fit)
upper <- pred$fit + (1.96*pred$se.fit)
plot(finaltable$mean.pain, predf,
ylab = "Predicted Probability of receiving Opioids",
xlab = "Mean Pain Score", bty = "n")
lines(finaltable$mean.pain, lower, lty = 2)
lines(finaltable$mean.pain, upper, lty = 2)
finaltable0205<- filter(finaltable, finaltable$admityear == "2002" |finaltable$admityear == "2003" |finaltable$admityear == "2004" |finaltable$admityear == "2005" )
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids")
year2002_2005
years1 <- glm(finaltable0205$formulary_drug_cd ~ finaltable0205$ethnicity + finaltable0205$mean.pain, family = binomial(link = "logit"))
summary(years1)
>>>>>>> 3c45aa62afc0c68672f12ea05e478ac249393885
confint(years1)
exp(coefficients(years1))
exp(confint(years1))
sjp.glm(years1)
finaltable0608<- filter(finaltable, finaltable$admityear == "2006" |finaltable$admityear == "2007" |finaltable$admityear == "2008")
year2006_2008 <- ggplot(finaltable0608, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids")
year2006_2008
years2 <- glm(finaltable0608$formulary_drug_cd ~ finaltable0608$ethnicity + finaltable0608$mean.pain, family = binomial(link = "logit"))
summary(years2)
confint(years2)
exp(coefficients(years2))
exp(confint(years2))
sjp.glm(years2)
finaltable0911<- filter(finaltable, finaltable$admityear == "2009" |finaltable$admityear == "2010" |finaltable$admityear == "2011")
year2009_2011 <- ggplot(finaltable0911, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids")
year2009_2011
years3 <- glm(finaltable0911$formulary_drug_cd ~ finaltable0911$ethnicity + finaltable0911$mean.pain, family = binomial(link = "logit"))
summary(years3)
confint(years3)
exp(coefficients(years3))
exp(confint(years3))
sjp.glm(years3)
secondlook <- glm(finaltable$formulary_drug_cd ~ finaltable$ethnicity + finaltable$mean.pain + finaltable$gender + finaltable$age + finaltable$insurance + finaltable$marital_status +finaltable$oasis, family = binomial(link = "logit"))
>>>>>>> 20aff4128f47a57318c2f2338b78c16aff6a6386
summary(secondlook)
confint(secondlook)
exp(coefficients(secondlook))
exp(confint(secondlook))
sjp.glm(secondlook)
<<<<<<< HEAD
#adjusted global test for all the years
finaltable$ethnicity<- relevel(finaltable$ethnicity, ref = "WHITE")
#adjusted global test for all the years
=======
year1secondlook <- glm(finaltable0205$formulary_drug_cd ~ finaltable0205$ethnicity + finaltable0205$mean.pain + finaltable0205$gender + finaltable0205$age + finaltable0205$insurance + finaltable0205$marital_status+finaltable0205$oasis, family = binomial(link = "logit"))
summary(year1secondlook)
confint(year1secondlook)
exp(coefficients(year1secondlook))
exp(confint(year1secondlook))
sjp.glm(year1secondlook)
year2secondlook <- glm(finaltable0608$formulary_drug_cd ~ finaltable0608$ethnicity + finaltable0608$mean.pain + finaltable0608$gender + finaltable0608$age + finaltable0608$insurance + finaltable0608$marital_status+finaltable0608$oasis, family = binomial(link = "logit"))
summary(year2secondlook)
summary(year2secondlook)
confint(year2secondlook)
exp(coefficients(year2secondlook))
exp(confint(year2secondlook))
sjp.glm(year2secondlook)
year3secondlook <- glm(finaltable0911$formulary_drug_cd ~ finaltable0911$ethnicity + finaltable0911$mean.pain + finaltable0911$gender + finaltable0911$age + finaltable0911$insurance + finaltable0911$marital_status +finaltable0911$oasis, family = binomial(link = "logit"))
summary(year3secondlook)
summary(year3secondlook)
confint(year3secondlook)
exp(coefficients(year3secondlook))
exp(confint(year3secondlook))
sjp.glm(year3secondlook)
#checking the link between oasis and opioids in each race category:
race_bl<- filter(finaltable,finaltable$ethnicity == "BLACK")
a<- glm(race_bl$formulary_drug_cd ~ race_bl$oasis)
summary(a)
race_wh<- filter(finaltable,finaltable$ethnicity == "WHITE")
b<- glm(race_wh$formulary_drug_cd ~ race_wh$oasis)
summary(b)
primarymodel <- glm(finaltable$formulary_drug_cd ~ finaltable$ethnicity, family = binomial(link = "logit"))
summary(primarymodel)
confint(primarymodel)
exp(coefficients(primarymodel))
exp(confint(primarymodel))
sjp.glm(primarymodel)
knitr::opts_chunk$set(echo = TRUE)
#setwd("~/data/HST.953") # Students will need to set their own path or see below
# If the following command doesn't work for you, please run file.choose(), find the aline dataset and replace what it outputs for "aline-dataset.csv" below:
dat <- read.csv("aline-dataset.csv")
firstlook <- glm(finaltable$formulary_drug_cd ~ finaltable$ethnicity + finaltable$mean.pain +finaltable$oasis, family = binomial(link = "logit"))
fir <- glm(finaltable$formulary_drug_cd ~ finaltable$ethnicity + finaltable$mean.pain +finaltable$oasis, family = binomial(link = "logit"))
predict(fir, newdata, type="response")
newdata <- with(finaltable, data.frame(oasis = c(0, 10), mean.pain=mean(mean.pain, na.rm=TRUE)))
predict(fir, newdata, type="response")
black <- filter(finaltable, finaltable$ethnicity == "BLACK")
white <- filter(finaltable, finaltable$ethnicity == "WHITE")
hispanic <- filter(finaltable, finaltable$ethnicity == "HISPANIC")
other <- filter(finaltable, finaltable$ethnicity == "OTHER")
class(black$mean.pain)
#All ethnicities
df <- with(finaltable, data.frame(pain = finaltable$mean.pain, ethnicity = finaltable$ethnicity))
pred <- predict(firstlook, df, type = "response", se.fit = TRUE)
predf <- pred$fit
lower <- pred$fit - (1.96*pred$se.fit)
upper <- pred$fit + (1.96*pred$se.fit)
plot(finaltable$mean.pain, predf,
ylab = "Predicted Probability of receiving Opioids",
xlab = "Mean Pain Score", bty = "n")
lines(finaltable$mean.pain, lower, lty = 2)
lines(finaltable$mean.pain, upper, lty = 2)
fir <- glm(finaltable$formulary_drug_cd ~ finaltable$ethnicity + finaltable$mean.pain +finaltable$oasis, family = binomial(link = "logit"))
newdata <- with(finaltable, data.frame(oasis = c(0, 10), mean.pain=mean(mean.pain, na.rm=TRUE)))
predict(fir, newdata, type="response")
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(tidyverse)
library(ggplot2)
library(dplyr)
library(sjPlot)
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
head(finaltable)
#Replacing NA to 0 and receiving an IV opioid to 1:
finaltable$formulary_drug_cd<- ifelse(is.na(finaltable$formulary_drug_cd),0,1)
#categorize race into 4 categories
finaltable$ethnicity <- ifelse(grepl("BLACK",finaltable$ethnicity),"BLACK", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("WHITE",finaltable$ethnicity),"WHITE", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("HISPANIC",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ASIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("UN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("MUL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("INDIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("SOUTH",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ISLAND",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("DECL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("EAST",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("PORTU",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity[is.na(finaltable$ethnicity)]<-"OTHER"
#categorize marital status into 4 categories
finaltable$marital_status <- ifelse(grepl("MARRIED",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("LIFE PARTNER",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("DIVORCED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("SEPARATED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("WIDOW",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("UN",finaltable$marital_status),"OTHER", finaltable$marital_status)
finaltable$marital_status[is.na(finaltable$marital_status)]<-"OTHER"
#categorize insurance into 3 catergories
finaltable$insurance <- ifelse(grepl("Medi",finaltable$insurance),"Government", finaltable$insurance)
#check that ethnicity, marital status and insurance were correctly categorised
unique(finaltable$ethnicity)
unique(finaltable$marital_status)
unique(finaltable$insurance)
>>>>>>> 20aff4128f47a57318c2f2338b78c16aff6a6386
finaltable$insurance<- as.factor(finaltable$insurance)
finaltable$ethnicity<- as.factor(finaltable$ethnicity)
finaltable$marital_status<- as.factor(finaltable$marital_status)
finaltable$ethnicity<- relevel(finaltable$ethnicity, ref = "WHITE")
finaltable$marital_status<- relevel(finaltable$marital_status, ref = "MARRIED")
<<<<<<< HEAD
secondlook <- glm(finaltable$drug ~ finaltable$ethnicity + finaltable$mean.pain + finaltable$gender + finaltable$age +finaltable$oasis, family = binomial(link = "logit"))
=======
primarymodel <- glm(finaltable$formulary_drug_cd ~ finaltable$ethnicity, family = binomial(link = "logit"))
summary(primarymodel)
confint(primarymodel)
exp(coefficients(primarymodel))
exp(confint(primarymodel))
sjp.glm(primarymodel)
firstlook <- glm(finaltable$formulary_drug_cd ~ finaltable$ethnicity + finaltable$mean.pain, family = binomial(link = "logit"))
summary(firstlook)
confint(firstlook)
exp(coefficients(firstlook))
exp(confint(firstlook))
sjp.glm(firstlook)
black <- filter(finaltable, finaltable$ethnicity == "BLACK")
white <- filter(finaltable, finaltable$ethnicity == "WHITE")
hispanic <- filter(finaltable, finaltable$ethnicity == "HISPANIC")
other <- filter(finaltable, finaltable$ethnicity == "OTHER")
class(black$mean.pain)
#All ethnicities
df <- with(finaltable, data.frame(pain = finaltable$mean.pain, ethnicity = finaltable$ethnicity))
pred <- predict(firstlook, df, type = "response", se.fit = TRUE)
predf <- pred$fit
lower <- pred$fit - (1.96*pred$se.fit)
upper <- pred$fit + (1.96*pred$se.fit)
plot(finaltable$mean.pain, predf,
ylab = "Predicted Probability of receiving Opioids",
xlab = "Mean Pain Score", bty = "n")
lines(finaltable$mean.pain, lower, lty = 2)
lines(finaltable$mean.pain, upper, lty = 2)
#Unadjusted regression for year 1
finaltable0205<- filter(finaltable, finaltable$admityear == "2002" |finaltable$admityear == "2003" |finaltable$admityear == "2004" |finaltable$admityear == "2005" )
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids")
year2002_2005
years1 <- glm(finaltable0205$formulary_drug_cd ~ finaltable0205$ethnicity, family = binomial(link = "logit"))
summary(years1)
confint(years1)
exp(coefficients(years1))
exp(confint(years1))
sjp.glm(years1)
#Unadjusted regression for year 2
finaltable0608<- filter(finaltable, finaltable$admityear == "2006" |finaltable$admityear == "2007" |finaltable$admityear == "2008")
year2006_2008 <- ggplot(finaltable0608, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids")
year2006_2008
years2 <- glm(finaltable0608$formulary_drug_cd ~ finaltable0608$ethnicity, family = binomial(link = "logit"))
summary(years2)
confint(years2)
exp(coefficients(years2))
exp(confint(years2))
sjp.glm(years2)
#Unadjusted regression for year 3
finaltable0911<- filter(finaltable, finaltable$admityear == "2009" |finaltable$admityear == "2010" |finaltable$admityear == "2011")
year2009_2011 <- ggplot(finaltable0911, aes(ethnicity, fill = formulary_drug_cd == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids")
year2009_2011
years3 <- glm(finaltable0911$formulary_drug_cd ~ finaltable0911$ethnicity, family = binomial(link = "logit"))
summary(years3)
confint(years3)
exp(coefficients(years3))
exp(confint(years3))
sjp.glm(years3)
#adjusted global test for all the years
secondlook <- glm(finaltable$formulary_drug_cd ~ finaltable$ethnicity + finaltable$mean.pain + finaltable$gender + finaltable$age + finaltable$insurance + finaltable$marital_status +finaltable$oasis + finaltable$e_score, family = binomial(link = "logit"))
>>>>>>> 20aff4128f47a57318c2f2338b78c16aff6a6386
summary(secondlook)
confint(secondlook)
exp(coefficients(secondlook))
exp(confint(secondlook))
sjp.glm(secondlook)
<<<<<<< HEAD
#adjusted global test for all the years
finaltable$insurance<- as.factor(finaltable$insurance)
finaltable$ethnicity<- as.factor(finaltable$ethnicity)
finaltable$marital_status<- as.factor(finaltable$marital_status)
finaltable$ethnicity<- relevel(finaltable$ethnicity, ref = "WHITE")
finaltable$marital_status<- relevel(finaltable$marital_status, ref = "MARRIED")
secondlook <- glm(finaltable$drug ~ finaltable$ethnicity + finaltable$mean.pain + finaltable$gender + finaltable$age +finaltable$oasis, family = binomial(link = "logit"))
summary(secondlook)
confint(secondlook)
sjp.glm(secondlook)
exp(coefficients(secondlook))
black <- model$coef[2]
black <- secondlook$coef[2]
intercept <- model$coef[1] # intercept
exp(coefficients(secondlook))
black <- secondlook$coef[2]
exp(coefficients(secondlook))
intercept <- secondlook$coef[1] # intercept
black <- secondlook$coef[2]
black
exp(coefficients(secondlook))
intercept <- exp(secondlook$coef[1]) # intercept
blk <- exp(secondlook$coef[2])
hisp <- exp(secondlook$coef[3])
othr <- exp(secondlook$coef[4])
pain <- exp(secondlook$coef[5])
male <- exp(secondlook$coef[6])
age <- exp(secondlook$coef[7])
oasis <- exp(secondlook$coef[8])
newdat <- data.frame(hp=finaltable$ethnicity)
newdat$drug = predict(secondlook, newdata=newdat, type="response")
plot(drug~ethnicity, data=finaltable, col="red4")
lines(finaltable$drug ~ finaltable$ethnicity, newdat, col="green4", lwd=2)
secondlook <- glm(finaltable$drug ~ finaltable$ethnicity + finaltable$mean.pain + finaltable$gender + finaltable$age +finaltable$oasis, family = binomial(link = "logit"))
newdat <- data.frame(hp=finaltable$ethnicity)
newdat$drug = predict(secondlook, newdata=newdat, type="response")
plot(drug~ethnicity, data=finaltable, col="red4")
lines(finaltable$drug ~ finaltable$ethnicity, newdat, col="green4", lwd=2)
newdat <- data.frame(hp=levels(finaltable$ethnicity))
newdat$drug = predict(secondlook, newdata=newdat, type="response")
secondlook <- glm(finaltable$drug ~ finaltable$ethnicity + finaltable$mean.pain + finaltable$gender + finaltable$age +finaltable$oasis, family = binomial(link = "logit"))
newdat <- data.frame(hp=levels(finaltable$ethnicity[1], finaltable$ethnicity[2], finaltable$ethnicity[3])
newdat$drug = predict(secondlook, newdata=newdat, type="response")
secondlook <- glm(finaltable$drug ~ finaltable$ethnicity + finaltable$mean.pain + finaltable$gender + finaltable$age +finaltable$oasis, family = binomial(link = "logit"))
newdat <- data.frame(hp=levels(finaltable$ethnicity[1], finaltable$ethnicity[2], finaltable$ethnicity[3]))
require(ggplot2)
ggplot(finaltable, aes(finaltable$ethnicity, as.numeric(finaltable$drug)-1, color=finaltable$mean.pain)) +
stat_smooth(method="loess", formula=y~x,
alpha=0.2, size=2, aes(fill=sex)) +
geom_point(position=position_jitter(height=0.03, width=0)) +
xlab("Age") + ylab("Pr(finaltable$drug)")
require(ggplot2)
ggplot(finaltable, aes(finaltable$ethnicity, as.numeric(finaltable$drug)-1, color=finaltable$mean.pain)) +
stat_smooth(method="loess", formula=y~x,
alpha=0.2, size=2, aes(fill=finaltable$mean.pain)) +
geom_point(position=position_jitter(height=0.03, width=0)) +
xlab("Age") + ylab("Pr(finaltable$drug)")
require(ggplot2)
ggplot(finaltable, aes(finaltable$mean.pain, as.numeric(finaltable$drug)-1, color=finaltable$ethnicity)) +
stat_smooth(method="loess", formula=y~x,
alpha=0.2, size=2, aes(fill=finaltable$mean.pain)) +
geom_point(position=position_jitter(height=0.03, width=0)) +
xlab("Age") + ylab("Pr(finaltable$drug)")
require(ggplot2)
ggplot(finaltable, aes(finaltable$mean.pain, as.numeric(finaltable$drug), color=finaltable$ethnicity)) +
stat_smooth(method="loess", formula=y~x,
alpha=0.2, size=2, aes(fill=finaltable$mean.pain)) +
geom_point(position=position_jitter(height=0.03, width=0)) +
xlab("Age") + ylab("Pr(finaltable$drug)")
require(ggplot2)
ggplot(finaltable, aes(as.numeric(levels(finaltable$ethnicity)), as.numeric(finaltable$drug), color=finaltable$mean.pain)) +
stat_smooth(method="loess", formula=y~x,
alpha=0.2, size=2, aes(fill=finaltable$mean.pain)) +
geom_point(position=position_jitter(height=0.03, width=0)) +
xlab("Age") + ylab("Pr(finaltable$drug)")
require(ggplot2)
ggplot(finaltable, aes(as.numeric(levels(finaltable$ethnicity)), as.numeric(finaltable$drug), color=finaltable$mean.pain)) +
stat_smooth(method="loess", formula=y~x,
alpha=0.2, size=2, aes(fill= as.numeric(levels(finaltable$ethnicity))) +
geom_point(position=position_jitter(height=0.03, width=0)) +
xlab("Age") + ylab("Pr(finaltable$drug)")
require(ggplot2)
ggplot(finaltable, aes(as.numeric(levels(finaltable$ethnicity)), as.numeric(finaltable$drug), color=finaltable$mean.pain)) +
stat_smooth(method="loess", formula=y~x,
alpha=0.2, size=2, aes(fill= as.numeric(levels(finaltable$ethnicity)))) +
geom_point(position=position_jitter(height=0.03, width=0)) +
xlab("Age") + ylab("Pr(finaltable$drug)")
require(ggplot2)
ggplot(finaltable, aes(as.numeric(levels(finaltable$ethnicity)), as.numeric(finaltable$drug), color=finaltable$mean.pain)) +
stat_smooth(method="loess", formula=y~x,
alpha=0.2, size=2, aes(fill= finaltable$ethnicity)) +
geom_point(position=position_jitter(height=0.03, width=0)) +
xlab("Age") + ylab("Pr(finaltable$drug)")
require(ggplot2)
a <- as.numeric(levels(finaltable$ethnicity))
ggplot(finaltable, aes(a, as.numeric(finaltable$drug), color=finaltable$mean.pain)) +
stat_smooth(method="loess", formula=y~x,
alpha=0.2, size=2, aes(fill= finaltable$ethnicity)) +
geom_point(position=position_jitter(height=0.03, width=0)) +
xlab("Age") + ylab("Pr(finaltable$drug)")
require(ggplot2)
a <- levels(finaltable$ethnicity))
require(ggplot2)
a <- levels(finaltable$ethnicity)
ggplot(finaltable, aes(a, as.numeric(finaltable$drug), color=finaltable$mean.pain)) +
stat_smooth(method="loess", formula=y~x,
alpha=0.2, size=2, aes(fill= finaltable$ethnicity)) +
geom_point(position=position_jitter(height=0.03, width=0)) +
xlab("Age") + ylab("Pr(finaltable$drug)")
#adjusted global test for all the years
finaltable$insurance<- as.factor(finaltable$insurance)
finaltable$ethnicity<- as.factor(finaltable$ethnicity)
finaltable$marital_status<- as.factor(finaltable$marital_status)
finaltable$ethnicity<- relevel(finaltable$ethnicity, ref = "WHITE")
finaltable$marital_status<- relevel(finaltable$marital_status, ref = "MARRIED")
secondlook <- glm(finaltable$drug ~ finaltable$ethnicity + finaltable$mean.pain + finaltable$gender + finaltable$age +finaltable$oasis, family = binomial(link = "logit"))
summary(secondlook)
confint(secondlook)
#sjp.glm(secondlook)
b <- secondlook$coefficients[2]
#adjusted global test for all the years
finaltable$insurance<- as.factor(finaltable$insurance)
finaltable$ethnicity<- as.factor(finaltable$ethnicity)
finaltable$marital_status<- as.factor(finaltable$marital_status)
finaltable$ethnicity<- relevel(finaltable$ethnicity, ref = "WHITE")
finaltable$marital_status<- relevel(finaltable$marital_status, ref = "MARRIED")
secondlook <- glm(finaltable$drug ~ finaltable$ethnicity + finaltable$mean.pain + finaltable$gender + finaltable$age +finaltable$oasis, family = binomial(link = "logit"))
summary(secondlook)
confint(secondlook)
#sjp.glm(secondlook)
b <- secondlook$coefficients[2]
b <- secondlook$coefficients[2]
b <- secondlook$coefficients[2]
secondlook <- glm(finaltable$drug ~ finaltable$ethnicity + finaltable$mean.pain + finaltable$gender + finaltable$age +finaltable$oasis, family = binomial(link = "logit"))
summary(secondlook)
confint(secondlook)
# Create labels
boxLabels = c("Black", "Hispanic", "Other")
# Enter summary data. boxOdds are the odds ratios (calculated elsewhere), boxCILow is the lower bound of the CI, boxCIHigh is the upper bound.
df <- data.frame(
yAxis = length(boxLabels):1,
boxOdds = c(b,h,o)
boxCILow = c(-0.431987951,-0.127186838,  -0.173518623)
b
h
secondlook$coefficients[2]
secondlook$coefficients[3]
secondlook$coefficients[4]
# Create labels
boxLabels = c("Black", "Hispanic", "Other")
# Enter summary data. boxOdds are the odds ratios (calculated elsewhere), boxCILow is the lower bound of the CI, boxCIHigh is the upper bound.
df <- data.frame(
yAxis = length(boxLabels):1,
boxOdds = c(-0.3515534,-0.002075366, -0.1058666)
boxCILow = c(-0.431987951,-0.127186838, -0.173518623)
# Create labels
boxLabels = c("Black", "Hispanic", "Other")
# Enter summary data. boxOdds are the odds ratios (calculated elsewhere), boxCILow is the lower bound of the CI, boxCIHigh is the upper bound.
df <- data.frame(
yAxis = length(boxLabels):1,
boxOdds = c(-0.3515534,-0.002075366, -0.1058666),
boxCILow = c(-0.431987951,-0.127186838, -0.173518623),
boxCIHigh = c(-0.2708931821, 0.1244000651, -0.0379375410)
)
# Plot
p <- ggplot(df, aes(x = boxOdds, y = yAxis))
p + geom_vline(aes(xintercept = 1), size = .25, linetype = "dashed") +
geom_errorbarh(aes(xmax = boxCIHigh, xmin = boxCILow), size = .5, height = .2, color = "gray50") +
geom_point(size = 3.5, color = "orange") +
theme_bw() +
theme(panel.grid.minor = element_blank()) +
scale_y_continuous(breaks = yAxis, labels = boxLabels) +
scale_x_continuous(breaks = seq(0,7,1) ) +
coord_trans(x = "log10") +
ylab("") +
xlab("Odds ratio (log scale)") +
annotate(geom = "text", y =1.1, x = 3.5, label ="Model p < 0.001\nPseudo R^2 = 0.10", size = 3.5, hjust = 0) + ggtitle("Intention to remove box turtles from the road")
# Create labels
boxLabels = c("Black", "Hispanic", "Other")
# Enter summary data. boxOdds are the odds ratios (calculated elsewhere), boxCILow is the lower bound of the CI, boxCIHigh is the upper bound.
df <- data.frame(
yAxis = length(boxLabels):1,
boxOdds = c(-0.3515534,-0.002075366, -0.1058666),
boxCILow = c(-0.431987951,-0.127186838, -0.173518623),
boxCIHigh = c(-0.2708931821, 0.1244000651, -0.0379375410)
)
# Plot
p <- ggplot(df, aes(x = boxOdds, y = yAxis))
p + geom_vline(aes(xintercept = 1), size = .25, linetype = "dashed") +
geom_errorbarh(aes(xmax = boxCIHigh, xmin = boxCILow), size = .5, height = .2, color = "gray50") +
geom_point(size = 3.5, color = "orange") +
theme_bw() +
theme(panel.grid.minor = element_blank()) +
scale_y_continuous(breaks = yAxis, labels = boxLabels) +
scale_x_continuous(breaks = seq(0,7,1) ) +
coord_trans(x = "log10") +
ylab("") +
xlab("Odds ratio (log scale)") +
annotate(geom = "text", y =1.1, x = 3.5, label ="Model p < 0.001\nPseudo R^2 = 0.10", size = 3.5, hjust = 0) + ggtitle("Intention to remove box turtles from the road")
df <- data.frame(
yAxis = length(boxLabels):1,
boxOdds = c(-0.3515534,-0.002075366, -0.1058666),
boxCILow = c(-0.431987951,-0.127186838, -0.173518623),
boxCIHigh = c(-0.2708931821, 0.1244000651, -0.0379375410)
)
# Create labels
boxLabels = c("Black", "Hispanic", "Other")
# Enter summary data. boxOdds are the odds ratios (calculated elsewhere), boxCILow is the lower bound of the CI, boxCIHigh is the upper bound.
df <- data.frame(
yAxis = length(boxLabels):1,
boxOdds = c(-0.3515534,-0.002075366, -0.1058666),
boxCILow = c(-0.431987951,-0.127186838, -0.173518623),
boxCIHigh = c(-0.2708931821, 0.1244000651, -0.0379375410)
)
# Plot
p <- ggplot(df, aes(x = boxOdds, y = yAxis))
p + geom_vline(aes(xintercept = 1), size = .25, linetype = "dashed") +
geom_errorbarh(aes(xmax = boxCIHigh, xmin = boxCILow), size = .5, height = .2, color = "gray50") +
geom_point(size = 3.5, color = "orange") +
theme_bw() +
theme(panel.grid.minor = element_blank()) +
scale_y_continuous(breaks = yAxis, labels = boxLabels) +
scale_x_continuous(breaks = seq(0,7,1) ) +
coord_trans(x = "log10") +
ylab("") +
xlab("Odds ratio (log scale)") +
annotate(geom = "text", y =1.1, x = 3.5, label ="Model p < 0.001\nPseudo R^2 = 0.10", size = 3.5, hjust = 0) + ggtitle("Intention to remove box turtles from the road")
# Create labels
boxLabels = c("Black", "Hispanic", "Other")
# Enter summary data. boxOdds are the odds ratios (calculated elsewhere), boxCILow is the lower bound of the CI, boxCIHigh is the upper bound.
df <- data.frame(
yAxis = (length(boxLabels):1),
boxOdds = c(-0.3515534,-0.002075366, -0.1058666),
boxCILow = c(-0.431987951,-0.127186838, -0.173518623),
boxCIHigh = c(-0.2708931821, 0.1244000651, -0.0379375410)
)
# Plot
p <- ggplot(df, aes(x = boxOdds, y = yAxis))
p + geom_vline(aes(xintercept = 1), size = .25, linetype = "dashed") +
geom_errorbarh(aes(xmax = boxCIHigh, xmin = boxCILow), size = .5, height = .2, color = "gray50") +
geom_point(size = 3.5, color = "orange") +
theme_bw() +
theme(panel.grid.minor = element_blank()) +
scale_y_continuous(breaks = yAxis, labels = boxLabels) +
scale_x_continuous(breaks = seq(0,7,1) ) +
coord_trans(x = "log10") +
ylab("") +
xlab("Odds ratio (log scale)") +
annotate(geom = "text", y =1.1, x = 3.5, label ="Model p < 0.001\nPseudo R^2 = 0.10", size = 3.5, hjust = 0) + ggtitle("Intention to remove box turtles from the road")
=======
#Adjusted model for year 1
year1secondlook <- glm(finaltable0205$formulary_drug_cd ~ finaltable0205$ethnicity + finaltable0205$mean.pain + finaltable0205$gender + finaltable0205$age + finaltable0205$insurance + finaltable0205$marital_status+finaltable0205$oasis + finaltable0205$e_score, family = binomial(link = "logit"))
summary(year1secondlook)
confint(year1secondlook)
exp(coefficients(year1secondlook))
exp(confint(year1secondlook))
sjp.glm(year1secondlook)
#Adjusted model for year 2
year2secondlook <- glm(finaltable0608$formulary_drug_cd ~ finaltable0608$ethnicity + finaltable0608$mean.pain + finaltable0608$gender + finaltable0608$age + finaltable0608$insurance + finaltable0608$marital_status+finaltable0608$oasis + finaltable0608$e_score, family = binomial(link = "logit"))
summary(year2secondlook)
summary(year2secondlook)
confint(year2secondlook)
exp(coefficients(year2secondlook))
exp(confint(year2secondlook))
sjp.glm(year2secondlook)
#Adjusted model for year 3
year3secondlook <- glm(finaltable0911$formulary_drug_cd ~ finaltable0911$ethnicity + finaltable0911$mean.pain + finaltable0911$gender + finaltable0911$age + finaltable0911$insurance + finaltable0911$marital_status +finaltable0911$oasis +finaltable0911$e_score, family = binomial(link = "logit"))
summary(year3secondlook)
summary(year3secondlook)
confint(year3secondlook)
exp(coefficients(year3secondlook))
exp(confint(year3secondlook))
sjp.glm(year3secondlook)
#checking the link between oasis and opioids in each race category:
race_bl<- filter(finaltable,finaltable$ethnicity == "BLACK")
a<- glm(race_bl$formulary_drug_cd ~ race_bl$oasis)
summary(a)
race_wh<- filter(finaltable,finaltable$ethnicity == "WHITE")
b<- glm(race_wh$formulary_drug_cd ~ race_wh$oasis)
summary(b)
unique(finaltable$drug)
sum(finaltable$formulary_drug_cd == "1" )
unique(finaltable$drug)
#adjusted global test for all the years
secondlook <- glm(finaltable$formulary_drug_cd ~ finaltable$ethnicity + finaltable$mean.pain + finaltable$gender + finaltable$age + finaltable$insurance + finaltable$marital_status +finaltable$oasis + finaltable$e_score, family = binomial(link = "logit"))
summary(secondlook)
confint(secondlook)
exp(coefficients(secondlook))
exp(confint(secondlook))
sjp.glm(secondlook)
library(readr)
library(tidyverse)
library(ggplot2)
library(dplyr)
library(sjPlot)
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
head(finaltable)
unique(finaltable$drug)
sum(finaltable$formulary_drug_cd == "1" )
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(dplyr)
library(tidyverse)
<<<<<<< HEAD
Fentanyl <- read_csv("~/SSmimic/Medication/Fentanyl.csv")
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(mgcv)
library(dplyr)
require("RPostgreSQL")
library(stringr)
library(tidyverse)
library(readr)
main.table <- read.csv("/SSMimic/Final Code and Write Up/Main Table.csv")
main.table <- read.csv("~/SSMimic/Final Code and Write Up/Main Table.csv")
# Extract drugs from Prescriptions, and write .csv files for each:
fentanyl <- dbGetQuery(con, "select * from Fentanyl")
Fentanyl <- read_csv("~/SSmimic/Medication/Fentanyl.csv")
Hydromorphone <- read_csv("~/SSmimic/Medication/Hydromorphone.csv")
Morphine <- read_csv("~/SSmimic/Medication/Morphine.csv")
Oxycodone <- read_csv("~/SSmimic/Medication/Oxycodone.csv")
Percocet <- read_csv("~/SSmimic/Medication/Percocet.csv")
Hydrocodone <- read_csv("~/SSmimic/Medication/Hydrocodone.csv")
#create tables with no duplicated hadm_id
Fent<- Fentanyl %>% distinct(hadm_id, .keep_all = TRUE)
Hydrom<- Hydromorphone %>% distinct(hadm_id, .keep_all = TRUE)
Morph<- Morphine %>% distinct(hadm_id, .keep_all = TRUE)
Oxycod<- Oxycodone %>% distinct(hadm_id, .keep_all = TRUE)
Perco <- Percocet %>% distinct(hadm_id, .keep_all = TRUE)
Hydrocod<- Hydrocodone %>% distinct(hadm_id, .keep_all = TRUE)
#create combined opioid medication table
opioid <- rbind(Fent,Hydrom, Morph, Oxycod, Perco, Hydrocod)
opioid_nohadmid<-  opioid %>% distinct(hadm_id, .keep_all = TRUE)
#create csv
write.csv(opioid, file = "opioid.csv")
#create  table with only IV drug presiscriptions and remove duplicated hadm_id
IVtable<- opioid[(opioid$route == "IV") |(opioid$route == "IV DRIP")|(opioid$route == "IVPCA") , ]
IVtable_nodup<-  IVtable %>% distinct(hadm_id, .keep_all = TRUE)
write.csv(IVtable_nodup,file = "IVtable_nodup.csv")
#create  table with NO IV drug presiscriptions and remove duplicated hadm_id
oralopioid<- opioid[!((opioid$route == "IV") |(opioid$route == "IV DRIP")|(opioid$route == "IVPCA")), ]
oralopioid_nodup<-  oralopioid %>% distinct(hadm_id, .keep_all = TRUE)
write.csv(oralopioid_nodup,file = "oralopioid_nodup.csv")
finaltable <- left_join(main.table , IVtable_nodup, "hadm_id")
finaltable <-  select(finaltable, "subject_id.y", "hadm_id", "icustay_id", "age", "gender", "ethnicity", "marital_status", "insurance", "los_hospital", "los_icu", "admityear", "mean.pain", "med.pain", "max_pain", "oasis", "e_score", "drug")
colnames(finaltable)[1] <- "subject_id"
View(finaltable)
finaltable$drug[finaltable$drug == "D5W"] <- NA
finaltable$drug[finaltable$drug == "Hydrocortisone Na Succinate"] <- NA
finaltable$drug[finaltable$drug == "Soln."] <- NA
finaltable$drug[finaltable$drug == "Soln"] <- NA
finaltable$drug[finaltable$drug == "Hydrocortiso"] <- NA
finaltable$drug[finaltable$drug == "Syringe"] <- NA
finaltable$drug[finaltable$drug == "5% Dextrose"] <- NA
# Replacing NA to 0 and receiving an IV opioid to 1:
finaltable$drug<- ifelse(is.na(finaltable$drug),0,1)
View(finaltable)
write.csv(finaltable, file = "finaltable.csv")
# Sample size
length(unique(finaltable$hadm_id))
library(readr)
library(tidyverse)
library(ggplot2)
library(dplyr)
library(sjPlot)
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
head(finaltable)
unique(finaltable$drug)
sum(finaltable$formulary_drug_cd == "1" )
library(survival)
finaltable <- read_csv("/~SSmimic/Final Code and Write Up/finaltable.csv")
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
# categorize race into 4 categories
finaltable$ethnicity <- ifelse(grepl("BLACK",finaltable$ethnicity),"BLACK", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("WHITE",finaltable$ethnicity),"WHITE", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("HISPANIC",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ASIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("UN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("MUL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("INDIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("SOUTH",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ISLAND",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("DECL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("EAST",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("PORTU",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity[is.na(finaltable$ethnicity)]<-"OTHER"
#categorize marital status into 4 categories
finaltable$marital_status <- ifelse(grepl("MARRIED",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("LIFE PARTNER",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("DIVORCED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("SEPARATED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("WIDOW",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("UN",finaltable$marital_status),"OTHER", finaltable$marital_status)
finaltable$marital_status[is.na(finaltable$marital_status)]<-"OTHER"
#categorize insurance into 3 catergories
finaltable$insurance <- ifelse(grepl("Medi",finaltable$insurance),"Government", finaltable$insurance)
#check that ethnicity, marital status and insurance were correctly categorised
unique(finaltable$ethnicity)
unique(finaltable$marital_status)
unique(finaltable$insurance)
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
# categorize race into 4 categories
finaltable$ethnicity <- ifelse(grepl("BLACK",finaltable$ethnicity),"BLACK", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("WHITE",finaltable$ethnicity),"WHITE", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("HISPANIC",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ASIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("UN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("MUL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("INDIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("SOUTH",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ISLAND",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("DECL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("EAST",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("PORTU",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity[is.na(finaltable$ethnicity)]<-"OTHER"
#categorize marital status into 4 categories
finaltable$marital_status <- ifelse(grepl("MARRIED",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("LIFE PARTNER",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("DIVORCED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("SEPARATED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("WIDOW",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("UN",finaltable$marital_status),"OTHER", finaltable$marital_status)
finaltable$marital_status[is.na(finaltable$marital_status)]<-"OTHER"
#categorize insurance into 3 catergories
finaltable$insurance <- ifelse(grepl("Medi",finaltable$insurance),"Government", finaltable$insurance)
#check that ethnicity, marital status and insurance were correctly categorised
unique(finaltable$ethnicity)
unique(finaltable$marital_status)
unique(finaltable$insurance)
sum(is.na(finaltable$insurance))
sum(is.na(finaltable$e_score))
sum(is.na(finaltable$oasis))
sum(is.na(finaltable$oasis))
sum(is.na(finaltable$insurance))
sum(is.na(finaltable$oasis))
View(finaltable)
finaltable2<- na.omit(finaltable$admityear)
finaltable$admityear<- na.omit(finaltable$admityear)
finaltable<- na.omit(finaltable$admityear)
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
finaltable[!is.na(finaltable$admityear),]
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(mgcv)
library(dplyr)
require("RPostgreSQL")
library(stringr)
library(tidyverse)
library(readr)
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
finaltable[!is.na(finaltable$admityear),]
finaltable<- finaltable[!is.na(finaltable$admityear),]
# categorize race into 4 categories
finaltable$ethnicity <- ifelse(grepl("BLACK",finaltable$ethnicity),"BLACK", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("WHITE",finaltable$ethnicity),"WHITE", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("HISPANIC",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ASIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("UN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("MUL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("INDIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("SOUTH",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ISLAND",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("DECL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("EAST",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("PORTU",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity[is.na(finaltable$ethnicity)]<-"OTHER"
#categorize marital status into 4 categories
finaltable$marital_status <- ifelse(grepl("MARRIED",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("LIFE PARTNER",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("DIVORCED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("SEPARATED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("WIDOW",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("UN",finaltable$marital_status),"OTHER", finaltable$marital_status)
finaltable$marital_status[is.na(finaltable$marital_status)]<-"OTHER"
#categorize insurance into 3 catergories
finaltable$insurance <- ifelse(grepl("Medi",finaltable$insurance),"Government", finaltable$insurance)
#check that ethnicity, marital status and insurance were correctly categorised
unique(finaltable$ethnicity)
unique(finaltable$marital_status)
unique(finaltable$insurance)
library(readr)
library(tidyverse)
library(ggplot2)
library(dplyr)
library(sjPlot)
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
head(finaltable)
unique(finaltable$drug)
sum(finaltable$formulary_drug_cd == "1" )
library(survival)
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
finaltable<- finaltable[!is.na(finaltable$admityear),]
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
finaltable<- finaltable[!is.na(finaltable$admityear),]
# categorize race into 4 categories
finaltable$ethnicity <- ifelse(grepl("BLACK",finaltable$ethnicity),"BLACK", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("WHITE",finaltable$ethnicity),"WHITE", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("HISPANIC",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ASIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("UN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("MUL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("INDIAN",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("SOUTH",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("ISLAND",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("DECL",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("EAST",finaltable$ethnicity),"OTHER", finaltable$ethnicity)
finaltable$ethnicity <- ifelse(grepl("PORTU",finaltable$ethnicity),"HISPANIC", finaltable$ethnicity)
finaltable$ethnicity[is.na(finaltable$ethnicity)]<-"OTHER"
#categorize marital status into 4 categories
finaltable$marital_status <- ifelse(grepl("MARRIED",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("LIFE PARTNER",finaltable$marital_status),"MARRIED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("DIVORCED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("SEPARATED",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("WIDOW",finaltable$marital_status),"DIVORCED/WIDOWED", finaltable$marital_status)
finaltable$marital_status <- ifelse(grepl("UN",finaltable$marital_status),"OTHER", finaltable$marital_status)
finaltable$marital_status[is.na(finaltable$marital_status)]<-"OTHER"
#categorize insurance into 3 catergories
finaltable$insurance <- ifelse(grepl("Medi",finaltable$insurance),"Government", finaltable$insurance)
#check that ethnicity, marital status and insurance were correctly categorised
unique(finaltable$ethnicity)
unique(finaltable$marital_status)
unique(finaltable$insurance)
write.csv(finaltable, file = "finaltable.csv")
library(readr)
library(tidyverse)
library(ggplot2)
library(dplyr)
library(sjPlot)
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
head(finaltable)
unique(finaltable$drug)
sum(finaltable$formulary_drug_cd == "1" )
library(survival)
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
finaltable <- read_csv("~/SSmimic/Final Code and Write Up/finaltable.csv")
finaltable$insurance<- as.factor(finaltable$insurance)
finaltable$ethnicity<- as.factor(finaltable$ethnicity)
finaltable$marital_status<- as.factor(finaltable$marital_status)
finaltable$ethnicity<- relevel(finaltable$ethnicity, ref = "WHITE")
finaltable$marital_status<- relevel(finaltable$marital_status, ref = "MARRIED")
finaltable0205<- filter(finaltable, finaltable$admityear == "2002" |finaltable$admityear == "2003" |finaltable$admityear == "2004" |finaltable$admityear == "2005" )
year2002_2005 <- ggplot(finaltable0205, aes(ethnicity, fill = drug == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids")
year2002_2005
finaltable0608<- filter(finaltable, finaltable$admityear == "2006" |finaltable$admityear == "2007" |finaltable$admityear == "2008")
year2006_2008 <- ggplot(finaltable0608, aes(ethnicity, fill = drug == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids")
year2006_2008
finaltable0911<- filter(finaltable, finaltable$admityear == "2009" |finaltable$admityear == "2010" |finaltable$admityear == "2011")
year2009_2011 <- ggplot(finaltable0911, aes(ethnicity, fill = drug == "1")) +
geom_bar(position = "fill") +
labs(x = "Ethnicity", fill = "Received IV Opioids")
year2009_2011
=======
>>>>>>> 20aff4128f47a57318c2f2338b78c16aff6a6386
>>>>>>> 3c45aa62afc0c68672f12ea05e478ac249393885
