knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(mgcv)
library(dplyr)
# install.packages("RPostgreSQL") ##Install package if needed
require("RPostgreSQL")
library(stringr)
morphine <- dbGetQuery(con, "select * from Morphine")
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(mgcv)
library(dplyr)
# install.packages("RPostgreSQL") ##Install package if needed
require("RPostgreSQL")
library(stringr)
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(mgcv)
library(dplyr)
# install.packages("RPostgreSQL") ##Install package if needed
require("RPostgreSQL")
library(stringr)
# loads the PostgreSQL driver
drv <- dbDriver("PostgreSQL")
# creates a connection to the postgres database (MIMIC)
# note that "con" will be used later in each connection to the database
con <- dbConnect(drv, dbname = "mimic",
host = "localhost", port = 5432,
user = "postgres", password = "postgres") # password and username were specific to my
# computer, removed here
dbGetQuery(con, "set search_path to mimiciii")
morphine <- dbGetQuery(con, "select * from Morphine")
View(morphine)
morphine <- dbGetQuery(con, "select * from Morphine")
oxycodone <- dbGetQuery(con, "select * from Oxycodone")
write.csv(fentanyl, file = "Fentanyl.csv")
fentanyl <- dbGetQuery(con, "select * from Fentanyl")
#colnames(icu_stay_table) <- c("subject_id", "hadm_id", "icustay_id", "intime", "icu_los")
write.csv(fentanyl, file = "Fentanyl.csv")
write.csv(morphine, file = "Morphine.csv")
write.csv(oxycodone, file = "Oxycodone.csv")
write.csv(percocet, file = "Percocet.csv")
percocet <- dbGetQuery(con, "select * from Percocet")
write.csv(percocet, file = "Percocet.csv")
write.csv(percocet, file = "Hydromorphone.csv")
(con, "select * from Hydromorphone")
hydromorphone <- dbGetQuery(con, "select * from Hydromorphone")
write.csv(percocet, file = "Hydromorphone.csv")
library(tidyverse)
library(readr)
opioid <- read_csv("~/SSmimic/Medication/opioid.csv")
library(tidyverse)
library(readr)
opioid <- read_csv("~/SSmimic/Medication/opioid.csv")
library(tidyverse)
library(readr)
opioid <- read_csv("/SSmimic/Medication/opioid.csv")
cohort <- read_csv("/SSmimic/Cohort/cohort.csv")
#merger the tables to ease analysis
finaltable<- left_join(cohort,opioid, "hadm_id")
#the table now has more that 120k observations -  patients without reported pain scores are being added to the table, therefore will remove ll rows where median or max reported pain is 0
sum(is.na(finaltable$formulary_drug_cd))
#create  table with only IV drug presiscriptions and remove duplicated hadm_id
IVtable<- finaltable[(finaltable$route == "IV") |(finaltable$route == "IV DRIP")|(finaltable$route == "IVPCA") , ]
IVtable_nodup<-  IVtable %>% distinct(hadm_id, .keep_all = TRUE)
#create  table with NO IV drug presiscriptions and remove duplicated hadm_id
oralopioid<- finaltable[!((finaltable$route == "IV") |(finaltable$route == "IV DRIP")|(finaltable$route == "IVPCA")), ]
oralopioid_nodup<-  oralopioid %>% distinct(hadm_id, .keep_all = TRUE)
#write csv - will still have duplicated hadm_id, (if one patients recieved multiple opioids)
write.csv(finaltable,file = "finaltable.csv")
ifelse(is.na(finaltable$formulary_drug_cd), 0, 1)
a<- filter(finaltable1, finaltable1$admityear == "2002")
