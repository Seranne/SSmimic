{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Untitled\"\noutput: html_document\n---\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE)\nlibrary(readr)\nlibrary(dplyr)\nlibrary(tidyverse)\n```\n\n```{r}\n\nmain_table <- read_csv(\"D:/Desktop/ss hst project/main.table.csv\")\nyears <- read_csv(\"D:/Desktop/ss hst project/years.csv\")\ncohort<- merge(main_table,years,by=\"hadm_id\")\nwrite.csv(cohort, file = \"cohort.csv\")\n```\n\n```{r}\n\nFentanyl <- read_csv(\"~/SSmimic/Medication/Fentanyl.csv\")\nHydromorphone <- read_csv(\"~/SSmimic/Medication/Hydromorphone.csv\")\nMorphine <- read_csv(\"~/SSmimic/Medication/Morphine.csv\")\nOxycodone <- read_csv(\"~/SSmimic/Medication/Oxycodone.csv\")\nPercocet <- read_csv(\"~/SSmimic/Medication/Percocet.csv\")\nHydrocodone <- read_csv(\"~/SSmimic/Medication/Hydrocodone.csv\")\n\n\n#create tables with no duplicated hadm_id\n\nFent<- Fentanyl %>% distinct(hadm_id, .keep_all = TRUE)\nHydrom<- Hydromorphone %>% distinct(hadm_id, .keep_all = TRUE)\nMorph<- Morphine %>% distinct(hadm_id, .keep_all = TRUE)\nOxycod<- Oxycodone %>% distinct(hadm_id, .keep_all = TRUE)\nPerco <- Percocet %>% distinct(hadm_id, .keep_all = TRUE)\nHydrocod<- Hydrocodone %>% distinct(hadm_id, .keep_all = TRUE)\n\n#create combined opioid medication table\nopioid <- rbind(Fent,Hydrom, Morph, Oxycod, Perco, Hydrocod)\nopioid_nohadmid<-  opioid %>% distinct(hadm_id, .keep_all = TRUE)\n\n#create csv\nwrite.csv(opioid, file = \"opioid.csv\")\n\n#create  table with only IV drug presiscriptions and remove duplicated hadm_id\n\nIVtable<- opioid[(opioid$route == \"IV\") |(opioid$route == \"IV DRIP\")|(opioid$route == \"IVPCA\") , ]\nIVtable_nodup<-  IVtable %>% distinct(hadm_id, .keep_all = TRUE)\nwrite.csv(IVtable_nodup,file = \"IVtable_nodup.csv\")\n\n\n#create  table with NO IV drug presiscriptions and remove duplicated hadm_id\n\noralopioid<- opioid[!((opioid$route == \"IV\") |(opioid$route == \"IV DRIP\")|(opioid$route == \"IVPCA\")), ]\noralopioid_nodup<-  oralopioid %>% distinct(hadm_id, .keep_all = TRUE)\nwrite.csv(oralopioid_nodup,file = \"oralopioid_nodup.csv\")\n\n```\n\n```{r}\n\nIVopioid <- read_csv(\"~/SSmimic/Medication/IVtable_nodup.csv\")\ncohort <- read_csv(\"~/SSmimic/Cohort/cohort.csv\")\n\n#merger the tables to ease analysis\n\nfinaltable<- left_join(cohort,IVopioid, \"hadm_id\")\n\n#Replacing NA to 0 and receiving an IV opioid to 1:\n\nfinaltable$formulary_drug_cd<- ifelse(is.na(finaltable$formulary_drug_cd),0,1)\n\n#categorize race into 4 categories\n\nfinaltable$ethnicity <- ifelse(grepl(\"BLACK\",finaltable$ethnicity),\"BLACK\", finaltable$ethnicity)\nfinaltable$ethnicity <- ifelse(grepl(\"WHITE\",finaltable$ethnicity),\"WHITE\", finaltable$ethnicity)\nfinaltable$ethnicity <- ifelse(grepl(\"HISPANIC\",finaltable$ethnicity),\"HISPANIC\", finaltable$ethnicity)\nfinaltable$ethnicity <- ifelse(grepl(\"ASIAN\",finaltable$ethnicity),\"OTHER\", finaltable$ethnicity)\nfinaltable$ethnicity <- ifelse(grepl(\"UN\",finaltable$ethnicity),\"OTHER\", finaltable$ethnicity)\nfinaltable$ethnicity <- ifelse(grepl(\"MUL\",finaltable$ethnicity),\"OTHER\", finaltable$ethnicity)\nfinaltable$ethnicity <- ifelse(grepl(\"INDIAN\",finaltable$ethnicity),\"OTHER\", finaltable$ethnicity)\nfinaltable$ethnicity <- ifelse(grepl(\"SOUTH\",finaltable$ethnicity),\"OTHER\", finaltable$ethnicity)\nfinaltable$ethnicity <- ifelse(grepl(\"ISLAND\",finaltable$ethnicity),\"OTHER\", finaltable$ethnicity)\nfinaltable$ethnicity <- ifelse(grepl(\"DECL\",finaltable$ethnicity),\"OTHER\", finaltable$ethnicity)\nfinaltable$ethnicity <- ifelse(grepl(\"EAST\",finaltable$ethnicity),\"OTHER\", finaltable$ethnicity)\nfinaltable$ethnicity <- ifelse(grepl(\"PORTU\",finaltable$ethnicity),\"HISPANIC\", finaltable$ethnicity)\n\nfinaltable$ethnicity[is.na(finaltable$ethnicity)]<-\"OTHER\"\n\nunique(finaltable$ethnicity)\n\n#filter out years 2001 and 2012 as they are incomplete years and select for relevant columns\n\nfinaltable<- filter(finaltable, !finaltable$admityear == \"2001\" & !finaltable$admityear == \"2012\")\nfinaltable<- select(finaltable,\"subject_id.x\", \"hadm_id\", \"med.pain\", \"age\", \"gender\", \"ethnicity\",\"max_pain\", \"mean.pain\", \"oasis\", \"e_score\", \"admityear\", \"drug\", \"formulary_drug_cd\", \"drug_name_generic\")\n\n#write csv final table: cohort plus IV opioids woth no duplicated hadm_id's\nwrite.csv(finaltable, file = \"finaltable.csv\")\n\n```",
    "created" : 1512143278147.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2821165292",
    "id" : "AF1556AA",
    "lastKnownWriteTime" : 1512146433,
    "last_content_update" : 1512146433839,
    "path" : "~/SSmimic/Cohort/cohort.Rmd",
    "project_path" : "Cohort/cohort.Rmd",
    "properties" : {
        "last_setup_crc32" : "673D6487d718e818"
    },
    "relative_order" : 6,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}