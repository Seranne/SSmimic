---
title: "Analysis"
output: html_document
---

```{r}
library(tidyverse)
library(readr)
opioid <- read_csv("~/SSmimic/Medication/opioid.csv")
cohort <- read_csv("~/SSmimic/Cohort/cohort.csv")

#merger the tables to ease analysis

finaltable<- left_join(cohort,opioid, "hadm_id")

#the table now has more that 120k observations -  patients without reported pain scores are being added to the table, therefore will remove ll rows where median or max reported pain is 0

sum(is.na(finaltable$formulary_drug_cd))

#create  table with only IV drug presiscriptions and remove duplicated hadm_id

IVtable<- finaltable[(finaltable$route == "IV") |(finaltable$route == "IV DRIP")|(finaltable$route == "IVPCA") , ]
IVtable_nodup<-  IVtable %>% distinct(hadm_id, .keep_all = TRUE)

#create  table with NO IV drug presiscriptions and remove duplicated hadm_id

oralopioid<- finaltable[!((finaltable$route == "IV") |(finaltable$route == "IV DRIP")|(finaltable$route == "IVPCA")), ]
oralopioid_nodup<-  oralopioid %>% distinct(hadm_id, .keep_all = TRUE)

#write csv - will still have duplicated hadm_id, (if one patients recieved multiple opioids)
write.csv(finaltable,file = "finaltable.csv")

ifelse(is.na(finaltable$formulary_drug_cd), 0, 1) 


a<- filter(finaltable1, finaltable1$admityear == "2002")

```

